[NQA 笔记](1.NQA%20%E5%B7%A5%E5%85%B7%E7%BB%93%E6%9E%84)
 
# 一./vobs 分支

143，rd_test
 
VR 开头的都是 WQY 管理、分析过的。
 
QATEST 就是 rd_test 的 NQA 版本，待分析
 
352 可能错多一点
    
# 二./work 分支

143，rd_test
 
git 分支：NQA_Zone_WQY
 
/work 下的一些库是江哥专门为大写改的库，151 现在暂时只能跑 O15 大写
    
# 三.测试机器

NQA：151,122,160  
QA：151,186（测试部新增用例，切换 QA 目录就能跑）（QA 的 utm 新一些）
    
# 四.NQA 命令使用

## 1.F_getfailinfo.sh：

对列表文件执行，打印 fail 的前后信息  
sh F_getfailinfo.sh fail_list
   

## 2.F_grep_list.sh：

对列表文件执行，打印文件中是否包含输入的错误信息  
sh F_getfailinfo.sh fail_list AF
   

## 3.gettc_install.sh:

部署 NQA 环境参考此脚本（不要直接执行，因为会删除本地的一些东西，照着步骤一步一步手动做就好）
   

## 4.list_test.sh

并发跑 list  
sh list_test.sh fail_list
   

## 5.list_test_single.sh

单个跑 list  
sh list_test_single.sh fail_list
   

## 6.single_test.sh

单跑 tdl 文件  
sh single_test.sh /vobs/test/test.tdl  
直接用 xrun 代替此命令
   

## 7.runloop_NQA.sh

老的全跑脚本，现在可以不用  
sh runloop_NQA.sh  
其跑的用例列表是/work/workiqa/testlist/testlist_NQA/NQA_testlist，比较原始，有一些过不了的用例没删（想改跑的用例可以自己改，也可以改对应的脚本）
   

## 8.runloop_WQY.sh

新的全跑脚本，现在都用这个（两次并发加一次串行，并发跑错误用例，速度更快）  
sh runloop_WQY.sh  
xnqa 命令的一部分  
其跑的用例列表是/work/workiqa/testlist/testlist_WQY/NQA_testlist，新的，不需要跑的用例都删了（想改跑的用例可以自己改，也可以改对应的脚本）
    
# 五.NQA 调试

[NQA 结构目录（可以参考一部分这里的内容）](1.NQA%20%E5%B7%A5%E5%85%B7%E7%BB%93%E6%9E%84)

## 1.IQA1210.cfg（往往是配置自己的 IQA1210_czy.cfg 以供使用）

### <1>O_COMPATIBLE 参数

YES 就是开启 O 兼容大写模式（开了之后，load 语句支持 O 兼容大写，不会报错了，否则关于 load 的地方都会报错）
 
### <2>HOSTNAME

IP 地址，部署在新机器上的时候注意改为新机器的 IP（有时候跑不过可能由此导致）
 
### <3>STOP_TEST_ON_FAILURE

此参数若为 NO，则单个 tdl 用例报第一个错，此用例会停止（全跑跑得快，但是不利于调试）。  
此参数若为 YES，则则单个 tdl 用例遇到报错也不会停止（全跑跑得慢，有利于调试，批量修改错误）
 
### <4>ENABLE_NULL_STRING 与 ENABLE_NULL_STRING

此参数影响空格与 NULL 有关，修改与否可以影响一个用例的过和不过，问题不大。
 
### <5>GBASEDBTDIR

指向静默安装目录，往往是使用自己的 single_test.sh 脚本时，配置一个固定的 GBASEDBTDIR 方便自己跑用例。
    
# 六.UTM 组件（/work/workiqa/utm）

## 1.介绍

NQA 工具的依赖资源所在，核心组件，基本上不用动（O15 用的是最新的 UTM 即 utm_qa.tar）。其他的分支用的老的 UTM（如 330utm.zip、340utm.zip、3XXutm.zip 等）跑，暂时没什么问题。是否升级最新的 UTM 视具体情况而定。
   

## 2.QApasswordFile 文件（/work/workiqa/utm/QApasswordFile）

以前是 userid sqlqa sh single_test.sh /vobs/test/test.tdl 命令跑  
现在使用 root 用户跑，root 用户的密码需要在此进行配置  
root:redhat151!
    
# 七.NQA 新功能

## 1.xrun 命令

配置进～/.bashrc 的命令，即 sh single_test.sh /vobs/test/test.sh
   

## 2.nqa 工具

配置进～/.bashrc 的命令，进入/home/wqy/F_NQA/，sh X_WQY.sh  
参数：q，d，k，c，w（可以都试试）  
（部署可以用 c，一步一步来，但是现在已经被 xnqa 取代）  
（包括 X_WQY.sh，Y_WQY.sh，Z_WQY.sh）
   

## 3.xnqa

### 1.介绍

<1>配置进～/.bashrc 的命令，进入/home/wqy/F_NQA/，sh D_WQY.sh  
<2>在 ids 安装包目录下（至少有 ids，csdk 和 jdbc 可选），执行命令：xnqa 351，即可在当前目录下，自动生成目录并静默安装 ids、csdk、jdbc，然后开始跑对应 git 分支的/vobs 用例。
 
### 2.修改方法

<1>现在只包含现有的 git 分支、默认 jdbc、默认 csdk，如果后续有新版本（如 O16、363 等），需要更改脚本和添加新的 jdbc 资源和 csdk 资源。
 
### 3.关于安装的判断

<1>按照文件大小，自动取得 ids，csdk，jdbc（100m，250m）  
<2>判断 ids 的 bin 下的文件数量，若小于 40，则判定静默安装失败，退出。  
<3>判断 csdk 是否安装成功，是安装 csdk 后，静默安装目录下的 bin 下的文件数量大于 ids 安装完成后 bin 下的文件数量（因为他们静默安装是同一个 bin），则判定 csdk 安装成功。  
<4>xnqa 就是想安装一下不全跑，把D_WQY.sh 中，sh runloop_WQY.sh 注释掉即可。
    
# 八.nqa 部署

[NQA 环境部署](2.NQA%20%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2)
    
# 九.nqa 分析

## 1.runloop_WQY.sh（看一下脚本即可）

此脚本优化了跑用例流程：  
<1>/work/workiqa/rerunlist/a2_rerun.list 中，是通不过、慢、影响别人等的不良用例，**是写死的**，现阶段共 44 个用例。  
<2>先第一次并发跑，800 多个，fail 的结果存入/work/workiqa/rerunlist/a1_rerun.list。  
<3>然后第二次并发跑，跑的是 a_rerun.list（a1_rerun.list 和 a2_rerun.list 合并去重之后的结果），结果存入 b1_rerun.list。  
<4>/work/workiqa/rerunlist/b2_rerun.list 中，是并行跑不过、串行可能跑过的用例，**是写死的**，现阶段共 47 个用例。  
<5>最后第三次串行跑，跑的是 b_rerun.list（b1_rerun.list 和 b2_rerun.list 合并去重之后的结果），结果集生成在 report_bak 中，nqa 测试结束。
   

## 2.分析

### <1>jdbc 类问题

现象：java 不认大写、不认类型 varchar 等，能看出来跟 jdbc 有关系。  
分析：utm 里的 jdbc 工具跟 ids 配套的 jdbc 差异过大，应把 ids 配套的 jdbc 更新到 utm 里。  
解决：见密网笔记---#替换jar包
 
### <2>其他问题

解决：见密网笔记---wqy的nqa分析笔记