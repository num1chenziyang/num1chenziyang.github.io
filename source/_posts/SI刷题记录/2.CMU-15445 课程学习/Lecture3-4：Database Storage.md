![Exported image](Exported%20image%2020250328133920-0.png)  
![CMU 15-445/645 DATABASE SYSTEMS Database Storage Disk Manager f5fr DBMS disk-oriented architecture, (non- volatile disk) DBMS (disk manager), (volatile) STORAGE HIERARCHY Volatile Random Access Byte-Addressable Non-Volatile Sequential Access Block-Addressable CARNEGIE MELLON CPU Registers CPU Caches DRAM SSD HDD Network Storage ACCESS TIMES 0.5 Ll Cache Ref 7 ns L 2 Cache Ref IOO ns DRAM 150,OOOns SSD ns HDD -30,000,000 ns Network Storage 1,000,000,000 ns Tape Archives Faster Smaller Slower Larger 0.5 sec 7 sec 100 sec 17 days 16.5 weeks 114 months 31.7 years i±DBMS os OS mmap OS ij, DBMS os DBMS DBMS ttos • % dirty pages • (buffer replacement) DBMS : • • • • • File Storage Page Layout Tuple Layout Data Representation System Catalogs Storage Models File Storage DBMS fios DBMS DBMS • DIY • DIY DBMS i*öffißo Database Pages os pages DBMS page page fiEßöJfiEF-fi{Z indexes LNÅA logs $3, DBMS page ± 0 page id, DBMS indirection layer page id page • Hardware Page: 4KB • OS Page: 4KB • Database Page: (1-16KB) DBMS pages fifiitöB, • Heap File Organization • Sequential/Sorted File Organization • Hashing File Organization Heap File Organization heap file pages pages pages pages Linked List Page Directory 0 Linked List pages • free page list • data page list Page Directory —T header page, page 51Jä: Free Page List Header Data Page List Page Data Page Data Data Data page file organization: linked list pages pages (directory pages), DBMS directory pages 5 data pages data pages Page Layout page header : header data, • • • • • Page Size Checksum DBMS Version Transaction Visibility Compression Information Data Layout data • Tuple-oriented: • Log-structured: Tuple Oriented Strawman Idea: header tuple fikJTZÄ, • (tuple) slotted Slotted Pages Page Header Data page layout append Page Num Tuples = 3 Tuple #1 Tuple #2 Tuple #3 data layout: tuple-oriented kßFßFfifi, header slot array slot fifä,e, Slot Array Header Tuple # Tuple #2 Tuple #3 Tuple Fixed/Var-length Tuple Data data layout: slotted pages • G slot array slot array 5 data page zatEi%j, page page • tuple DBMS Log Structured log-structured RFfi{ INSERT INSERT DELETE INSERT UPDATE UPDATE Pa e id=l val=a id=2 val=b id=4 id=3 val=c val=X id=3 val=Y id=4 log-structured: append id=l , val=a INSERT id=2 , val=b INSERT DELETE Id 4 id=2 INSERT id=3 val=X id=3 UPDATE id=4 val=Y (id=4 UPDATE log-structured: build indexes page Level Compaction Level O Log File File Level 1 Log File Level 2 Tuple Layout Log File Universal Compaction Log File File Log File File File Log File Log File log-structured: compress logs -Efi5iiji€7 page fi layout öJL'Å55Fi header 5 data #581355, data tuple-oriented log structured tuple-oriented fi layout * , DMBS 90föJFfi% tuple tuple AD : • Visibility Info (concurrency control): tuple • Bit Map for NULL values tuple header data Header Tuple Attribute Data tuple-layout DBMS fifijf*, denormalize, tuple fi attribute data, Tuple CREATE TABLE foo ( a INT PRIMARY KEY, b INT tOT NULL, c INT, d DOUBLE, e FLOAT order of tuple attribute data DBMS join E-x, CREATE TABLE foo ( a INT PRIMARY KEY, b INT NOT NULL, CREATE TABLE bar ( c INT PRIMARY KEY, a INT foo (a), related tables fif'p foo Header a bar Header c Header c Header c a a table foo and table bar foo foo bar pre-join of table foo and bar bar foo join E-x, join DBMS tuple, tuple (record identifier), page_id + offset/slot %AÜ, DBMS (E DBMS +E*ÄäafilhfiEo Tuple Storage —T tuple DBMS DBMS ficatelogs schema fi7i*æfäe, DBMS tuple Data Representation INTEGER/BIGINT/SMALLINT/TINYINT FLOAT/REAL vs. NUMERIC/DECIMAL VARCHAR/VARBINARY/TEXT/BLOB TIME/DATE/TIMESTAMP FLOAT/REAL/DOUBLE vs. NUMERIC/DECIMAL C/C++ Representation IEEE-754 Standard / Fixecft)0int Decimals Header with length, followed by data bytes 32/64-bit integer of (micro) seconds since Unix epoch float, real, double IEEE-754 fixed-precision, 4kinc1ude <stdio.h> int main (int argc, char* argv[]) float x = 0.1; float y = 0.2; printf("0.3 = %.20f\n", 0 3) - 0.30000001192092895508 @ .29999999999999998890 range precision (arbitrary precision), numeric/decimal VARCHAR —N, NUMERIC char NumericDigit; typedef unsigned typedef struct { int ndigits; int weight; int scale; int sign; NumericDiéit * digits: 4k of Digits Weight of 1st Digit Scale Factor Positive/Negative/NaN Diéit Storage ](Exported%20image%2020250328133921-1.png)  
![(arbitrary precision), numeric/decimal VARCHAR —N, NUMERIC char NumericDigit; typedef unsigned typedef struct { int ndigits; int weight; int scale; int sign; NumericDigit } numeric; Large Values * digits ; 4k of Digits Weight of 1st Digit Scale Factor Positive/Negative/NaN Digit Storage DBMSs tuple DBMS overflow/TOAST page: —t page X/J\, large values, Overflow Pa e VARCHAR DATA overflow storage page External Value Storage —æ DBMSs BLOB, DBMSs durability protections transaction protections, dump x, System Catalogs DBMS • Table, columns, indexes, views • Users, permissions • Internal statistics n-YFfifi DBMSs tuple. SQL-92 INFORMATION_SCHEMA DBMSs SQL-92 Postgres MySQL SQLite SELECT FROM INFORMATION_SCHEMA.TABLES table_catalog = '<db name>' ; WHERE SELECT * FROM INFORMATION SCHEMA. TABLES table_name = 'student' ; WHERE OLTP & OLAP WORKLOAD CHARACTERIZATION Complex OLAP Social Networks o OLTP Simple Writes Workload Focus Reads OLTP (On-line Transaction Processing) , OLTP-queries.sql SELECT F ROM INNER ON WHERE UPDATE SET WHERE pages AS P JOIN revisions AS P. latest = R. rev1D P. pageID useracct lastLogin = NOW() , hostname = ? userID = ? INSERT INTO revisions VALUES (?,?.. OLAP (On-line Analytical Processing) , OLAP-queries.sql SELECT COUNT(U.1astLogin) OLAP EXTRACT (month FROM U.1astLogin) AS month FROM useracct AS U WHERE U. hostname LIKE '96. gov' GROUP BY EXTRACT(month FROM U. lastLogin) ; OLAP OLTP Data Storage Models Relational Data Model attributes tuple, tuple relation, relation tuple, tuple fi attributes $JF-fi{fiit0 —'is tuple $JFfiä attributes OLAPO Data Storage Models • fiF-fi%: N-ary Storage Model (NSM) • 51JFfi{: Decomposition Storage Model (DSM) NSM NSM EIFfi: —T tuple äkJFfifi attributes E- page NSM Disk Page Header Header Header userID userName userPass hostname userID userPass hostname user ID userName userPass hostname OLTP Em , lastLogin lastLogin lastLogin DBMS attributes Index, üOf51J-F$J userlD tuples, N-ARY STORAGE MODEL (NSM) SELECT WHERE AND INSERT VALUES * FW•I useracct userName = ? userPass = INTO useracct NSM Disk Page HeaWr Header Hea&r• user1D userID user1D use r ID userNane userName userNane user Nane Index userPass hostnæ userPass hostnane userPass userPass hostn•e Lecture 7 lastLogin lastLogin lastLogin lastLogin OLAP fiifiJ, IV-ARY STORAGE MODEL (NSM) SELECT COUNT .1astL in EXTRACT(month FROM AS month FROM useracct AS U '%.gov• GROUP BY EXTRACT(month FROM NS" Dis Header Header user:' usern userNM* user' as lastLogin lastLogin LastLogin lastLogin Useless Data tuple fi hostname 5 lastLogin attributes, tuple $JFfifi attributes, , NSM • Advantages 0 fflJß*, tuple (Ffifi attributes) $JÄifi • Disadvantages tuples, attributes DSM DSM tuples attribute page * , DSM Disk Page OLAP userID userName lastLogin userPass Postnane hostnane hostn— hostnane hostnM* OLAP I/O SELECT , EXTRACT(month AS month useracct AS U '%.gov' GRa-lP BY EXTRACT(month FROM "o s t "one hostnane DSM attributes tuple attributes? 1. Fixed-length Offsets: attribute %ßREK$J, offset ( 2. Embedded Tuple Ids: attribute tuplelD Offsets 1 DSM • Advantages I/O *kf'F • Disadvantages tuplesx attributes Embedded Ids slidel, video 1 slide2 video? ](Exported%20image%2020250328133930-2.png)

note：  
1.内存：易失，自由访问，按字节存储。  
2.外存：持久化，顺序访问，按块存储。  
3.持久化的内存已经实现，价格高昂（电脑断电，开机如初）。

补充图：介绍数据库引擎、内存、外存关系。
 ![DISK-ORIENTED DBMS Get page #2 Lecture 5 Pointer to page #2 o Memory Disk e CMU-DB (Fall 2021) 10 Lectures 11-12 xecution ngine Interpret the layout of page #2... Lectures 3-4 Pages ](Exported%20image%2020250328133938-3.png)