![SQL SQL Aggregates Group By Having Output Redirection Output Control Nested Queries Common Table Expressions String Operations Date/Time Operations Window Functions ](Exported%20image%2020250328133909-0.png)  
![CMU 15-445/645 DATABASE SYSTEMS Advanced SQL SQL Relational Model Procedural Non-Proceduralo Relational Algebra, Procedural SQL Non-Procedural SQL DBMS SQL • "SEQUAL" from IBM's System R prototype Structured English Query Language Adopted by Oracle in the 1970s • IBM releases DB2 in 1983 • ANSI Standard in 1986. ISO in 1987 Structured Query Language SQL SQL 2016, DBMSs SQL-92 SQL SQL • • • • • • Aggregations + Group By String / Date / Time Operations Output Control + Redirection Nested Queries Common Table Expressions Window Functions student(sid, name, login, gpa) sid 53666 53668 name Kanye Bieber login kayne@cs jbieber@cs age 39 22 enrolled(sid, cid, grade) sid 53666 53688 course(cid, name) cid 15-445 15-721 Aggregates Aggregates • AVG(coI) • MIN(col) • MAX(col) • SUM(col) • COUNT(col) cid 15-445 15-721 EfD@E: grade c count.sql SELECT F ROM SELECT F ROM SELECT F ROM COUNT (login) AS cnt student WHERE login LIKE AS cnt student WHERE login LIKE COUNT (1) AS cnt student WHERE login LIKE multiple.sql SELECT AVG(gpa), COUNT(sid) FROM student WHERE login LIKE distinct.sql SELECT COUNT (DISTINCT login) FROM student WHERE login LIKE aggregate mix. sql SELECT AVG(s.gpa), e.cid FROM enrolled AS e, student AS s WHERE e. sid - s.sid; DBMSs Group By group by GPA SELECT AVG(s.gpa), e.cid name Database Systems Advanced Database Systems DBMS aggregates , FROM enrolled AS e, student AS s WHERE e. sid — s.sid GROUP BY e.cid; aggregates group by iä6], SELECT AVG(s.gpa), e.cid, s.name FROM enrolled AS e, student AS s WHERE e. sid — s.sid GROUP BY e.cid, s. name; Having aggregation WHERE * , HAVING * , SELECT F ROM WHERE GROUP HAVING AVG(s.gpa) AS avg_gpa, e.cid enrolled AS e, student AS s e. sid = s. sid BY e.cid avg_gpa > 3.9; Output Redirection • iRfi51Jü, SQL-92.sql MySQL.sql SELECT DISTINCT cid INTO Courselds FROM enrolled; INSERT INTO Courselds ( SELECT DISTINCT cid FROM enrolled Output Control Order By ORDER BY [ASCIDESC] SELECT Sid, grade FROM enrolled WHERE cid = '15-721' ORDER BY grade; SELECT sid FROM enrolled WHERE cid - ' 15-721 ' ORDER BY grade DESC, sid ASC; Limit LIMIT <count> [offset] Sid, name FROM student SELECT login LIKE WHERE LIMIT 10; Sid, name FROM student SELECT WHERE login LIKE LIMIT 20 OFFSET 10; Nested Queries nested queries inner queries outer queries, query queries outer queries {5] 1 : '15-445' FROM student SELECT name WHERE Sid IN ( SELECT sid FROM enrolled WHERE cid '15-445' SELECT (SELECT S. name FROM student AS S E. Sid) AS sname WHERE S.sid = FROM enrolled AS E WHERE cid = '15-445'; • ALL: ,Efifi inner queries • ANY: inner queries gpa 4.0 3.9 e.cid s.name: A inner • IN: 5 ANY • EXISTS: inner queries SELECT name FROM student WHERE sid ANY ( SELECT sid FROM enrolled WHERE cid = '15-445' SELECT Sid, name FROM student WHERE sid ALL ( SELECT sid FROM enrolled SELECT Sid, name FROM student WHERE sid IN ( SELECT MAX(sid) FROM enrolled SELECT Sid, name FROM student WHERE sid IN ( SELECT sid FROM enrolled ORDER BY sid DESC LIMIT 1 SELECT * FROM course WHERE NOT EXISTS ( SELECT * FROM enrolled WHERE course. cid = enrolled. cid nested queries Common Table Expressions id WITH cteName AS ( SELECT 1 SELECT * FROM cteName WITH cteName (coli, c012) AS ( SELECT 1, 2 SELECT coli + c012 FROM cteName WITH cteName1(c01) AS (SELECT 1), cteName2(c01) AS (SELECT 2) SELECT Cl. col + C2.c01 FROM cteName1 AS Cl, WITH cteSource (maxld) AS ( SELECT MAX(sid) FROM enrolled FROM student, cteSource SELECT name WHERE student. sid = cteSource . maxld f51J2: *JED 1-10 WITH RECURSIVE cteSource (counter) AS ( (SELECT 1) UNION ALL (SELECT counter + 1 FROM cteSource WHERE counter < 10) SELECT * FROM cteSource; String Operations DBMS SQL-92 Postgres MySQL SQLite Oracle String Case Sensitive Sensitive lnSensitive Sensitive Sensitive cteName2 AS C2; String Quotes Single Only Single Only Single/Double Single/DoubIe Single Only condition : string-equal.sql SQL -92 WHERE UPPER(name) = UPPER( KaNyE') MySQL WHERE name "KaNyE" String Matching SELECT * FROM enrolled AS e WHERE e.cid LIKE '15-%' ; SELECT * FROM student AS s WHERE s. login LIKE , String Operations SQL-92 string SELECT SUBSTRING(name, O, 5) AS abbrv_name FROM student WHERE sid = 53688; SELECT * FROM student AS s WHERE UPPER(e.name) LIKE 'KAN%' ; DBMS string SQL-92 , concatenation.sql SQL -92 SELECT name FROM student WHERE login = LOWER(name) MySQL FROM student SELECT name LOWER(name) WHERE login SELECT name FROM student WHERE login = strings Date/Time Operations DBMS Window Functions f51J 1 : DBMS SELECT OVER AS row_num FROM enrolled; Sid 53666 53688 53688 53655 53666 cid 15-445 15-721 15-826 15-445 15-721 grade c B B c 1 2 3 4 5 window functions - examplel SELECT cid, Sid, OVER (PARTITION BY cid) FROM enrolled ORDER BY cid; cid 15 -445 15 -445 15-721 15-721 15-826 SELECT * FROM ( SELECT Sid 53666 53655 53688 53666 53688 row number 1 2 1 2 1 window functions - example 2 RANK() OVER (PARTITION BY cid ORDER BY grade ASC) AS rank FROM enrolled ) AS ranking WHERE ranking. rank slide video ](Exported%20image%2020250328133911-1.png)