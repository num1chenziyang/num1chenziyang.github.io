---
title: （实战）5.sw3231-Uos1050d
date: 2025-04-02 23:47:10
categories:
  - SDLC编译工作
  - 编译实战
tags:
  - 编译
password: 9761565829chen
---
# （前言）机器详情
|            |                |          |
| ---------- | -------------- | -------- |
| 2025-02-24 |                |          |
| ipv4       | 172.16.4.24    |          |
| 架构         | sw_64          |          |
| 处理器        | sw3231         |          |
| 系统         | uos1050d_sw_64 |          |
| 机房位置       |                |          |
| 密码         | root           | Big4ifmx |
 
note：  
1.此机器为唯一一台 sw64 架构机器，十分的珍贵。

---

# （一）uos系统安装与配置
# 一.系统安装流程

1.此机器处理器为 sw3231，较老，安装 uos1070 会卡死不动，安装 uos1050d_sw_64 成功。
 
2.安装 uos1050d 时，选择安装软件时，切记选择有桌面选项，其他的都没桌面，没桌面的话配置网络十分的麻烦。
 
3.配置好网络后，外网机 ssh 本机被拒绝，因为本机的 ssh 配置原因，拒绝了以 root 用户进行访问，有些机器有此问题有些没有。  
[https://blog.csdn.net/qq_41086359/article/details/116380159](https://blog.csdn.net/qq_41086359/article/details/116380159)

![vim /etc/ssh/sshd_config 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # Authentication: #LoginGraceTime 2m #PermitRootLogin prohibit—password #StrictModes yes # Authentication: LoginGraceTime 2m PermitRootLogin yes StrictModes yes ](Exported%20image%2020250328135147-0.png)  

## note：

### 1.关闭休眠

最好在设置中，进入电池选项，把休眠什么的关闭，否则可能出现长时间不操作而服务器休眠，导致远程 ssh 断连。
 
### 2.注释tty

在 /etc/profile 中，有一行 tty 开头的命令，此命令为“teletypewriter”的缩写，与终端相关。其会在一段时间不操作后自动断开终端，非常影响使用，务必注释掉！！！
    
# 二.软件源配置

-==yum==：用于==RPM包系统==（如CentOS、Fedora、RHEL）。  
-==apt==：用于==DEB包系统==（如Ubuntu、Debian、Uos）。  
本系统为 Uos，安装软件工具自然为 apt  
[apt 工具介绍与使用](1.apt%20%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8)

---

# （二）代码适配
# 一.InstallAnywhere（环境配置的一部分，单拿出来说一下）

将系统的 java 替换掉/opt/InstallAnywhere/IA2011/jre，可以执行 build 则说明替换成功，否则执行 build 会报错 format 问题（即架构问题）
    
# 二.cm

使用分支 **u20-1050d-sw3231** 即可，java 已经重做过了（此处的 java 作用是使用 vm 虚拟机工具对 ids 进行打包，重做方法见：[java工具重做流程](3.java%E5%B7%A5%E5%85%B7%E9%87%8D%E5%81%9A%E6%B5%81%E7%A8%8B)）
    
# 三.代码

## 1.对 sw64 的适配

143：Administrator/code ---> release_v8.8_uos20_sw3231 分支  
合并 jys 提交，对修改的部分内容进行改造
   

## 2.openssl1.1.1w升级

合并 chenziyang 对 x86 架构的 openssl1.1.1w 升级的提交，对修改的部分内容进行改造
    
# 四.openssl1.1.1w 源码安装

## 1.安装流程如下

[openssl3.2.2源码编译安装](2.openssl3.2.2源码编译安装.md)
 
2.  
PLATFORM=linux

---

# （三）编译前工具问题
# 一.make 工具编译重装（与此无关）

## 1.问题

在 asf/al 中，al.o 没有编译出来，导致 libthasf.a 创建失败。  
其 makefile 中：  
.c.o：  
rm $*.o  
.c.o 为旧式的后缀规则，报错 warning：overriding recipe for target .c.o
 
## 2.分析

<1>原以为是此原因导致 asf 工具没有 make 出来，怀疑是 make 工具的版本导致，Uos 是 4.2 而 redhat 是 3.8。  
<2>实际并非如此，warning 不会导致编译错误，只是警告而已，且正常的版本也会有此 warning，不该关注此方面。真正原因见下述：[asf 目录](4.CSDK%20编译适配.md)
 
## 3.解决

虽然问题与 make 工具的版本无关，但是在 Uos系统-sw64架构上 make 工具源码编译安装过程还是有记录价值的。  
<1>配置  
./configure  
make  
<2>
    
# 二.ed 工具

./configure ==--prefix=========/home====/czy/ed-1.1==  
==make==  
==make install==  
==然后做软链接 ln -s== ==/home====/czy/ed-1.1/bin /bin/ed（否则编译脚本里的 ed 仍找不到）==
    
# 三.dash 与 bash

在本系统中，/bin/sh 连接的是 dash，导致很多脚本运行异常，应把 /bin/sh 软链接到 bash 以正常使用编译过程中的脚本。

---

# （四）CSDK 编译适配
# 一.libthasf.a 创建失败（asf 目录）

## 1.问题

|   |   |
|---|---|
|报错信息来源|makedevsdk.out|
|报错信息内容|libthasf.a 创建失败|
|报错初步分析|asf 目录下 thread/al.o 与 th_shared/al.o 缺失，导致 libthasf.a 创建失败|
 
## 2.分析

tristarm/setup/setup.linuxsw64 文件中，THREADPROD 参数指向的 libpthread.so 文件未找到，导致 makefile 中 if 判断 THREADPROD -f 不存在，故没有走创建多线程的 al.o 流程。
 
## 3.解决

找到系统的 libpthread.so，将 THREADPROD 改对即可。
 
## 4.经验

此处是在 makefile 中，发现创建 al.o 的 if 判断失败。下面的 esqlc 问题和此问题相同，都是系统的 so 未找到，导致脚本中的 if 判断失败。这里是 makefile 脚本，下面是 esql 脚本。当只看脚本不能定位问题时，可以在编译过程中调试脚本，添加 set -x 命令，在 out 文件中一步一步看就行。
    
# 二.undefined references to 'ifx_sqlcode' follow

## 1.问题

|   |   |
|---|---|
|报错信息来源|makedevsdk.out|
|报错信息内容|# undefined references to 'ifx_sqlcode' follow|
|报错初步分析||
 
## 2.分析

搜函数 ifx_sqlcode 在哪，找到此函数的 c 文件，是 sqli/iqdiag.c，对 iqdiag.o 使用 nm 命令，发现确实没有定义 ifx_sqlcode 函数。此时问题就很明显了，在此函数上面有条件#ifdef IFX_THREAD，说明此宏未生效。
 
此宏未生效的原因是，编译的时候未加或删除了-thread 选项（曾为了解决 esqlc 问题，将-thread 改为-pthread，这是不正确的，应是新加入-pthread 或者-lpthread 等其他解决方法），将 -thread 选项恢复。
 
## 3.解决

见下述 esqlc 问题
      

# 三.esqlc 问题

tristarm/setup/setup.linuxsw64 文件中，SYSTHDIR 参数配置的是 /usr/lib，esql.sh 脚本会使用此参数拼接 libpthread.so 的路径，即 /usr/lib/libpthread.so。然而 Uos1050d_sw64 系统的 libpthread.so 是/usr/lib/sw_64-linux-gnu/libpthread.so，导致 -f 判断 libpthread.so 失败，esqlc 执行报错。
 
## 经验

1.set -x 调试 esql 脚本，去寻找里面不对的路径和逻辑。  
2.不要怀疑工具的问题，一般来说就是什么工具没装上，什么 so 路径没有直到。
    
# 四.infxmsg

tristarm/em/infxmsg 下编出来之后放入 /usr/bin 下即可，否则 esql 报错找不到 infxmsg 工具。
    
# 五.字符集问题

---

# （五）IDS 编译适配
# 一.找不到文件pam_appl.h

## 1.问题

|   |   |
|---|---|
|报错信息来源|makelibs.out|
|报错信息内容|找不到文件pam_appl.h|
 
## 2.分析

在编译 oslib 下的 osauth.o 时，117 行#include<security/pam_appl.h>找不到。在160机器的 / 下搜，找到 pam_appl.h 文件在 /usr/include/security 目录下，而此目录在uos中没有。  
**本质原因是pam****-devel工具未安装**
 
## 3.解决

uos 的 apt 工具没有 pam-devel，需要源码编译安装。
 
## 4.经验

当有一些系统的 .h 文件找不到时，去正常服务器 find，若能找到，考虑此开发包未安装。以 libaio.h 为例，其属于开发包中的头文件（编译时依赖），需要安装 ​开发包（名称通常为 libaio-dev 或 libaio-devel）才能获取头文件。需要安装的 devel 包如下：

|   |   |
|---|---|
|libX[x]11|libX11-devel|
|pam|pam-devel|
|elfutils|elfutils-devel|
|ncures|ncures-devel|
|libaio|libaio-devel|
|libuuid|uuid.h 直接从别处取就好|
    
# 二./usr/bin/ld: cannot find -lpam

## 1.问题

|   |   |
|---|---|
|报错信息来源|makelibs.out|
|报错信息内容|/usr/bin/ld: cannot find -lpam|
|相似报错|/usr/bin/ld: cannot find -lelf|
 
## 2.分析

ld 报错：cannot find -lpam，这说明没有找到文件 libpam.so ，由前面 CSDK 经验得知，本架构的 tristarm/setup/setup.linuxsw64 文件配置的 SYSTHDIR 路径为 /usr/lib，而有一些 lib 资源在 /usr/lib/sw_64-linux-gnu 下，与 esqlc 出现的问题相同。
 
## 3.解决

/usr/lib 下做软链接，将 libpam.so 链到 /usr/lib/sw_64-linux-gnu/libpam.so.0，问题解决。
    
# 三.找不到 libaio.h

## 1.工具源码下载

1.以此系统 Uos 为例，找不到 libaio.h，很明显是没有安装 libaio-devel 导致。
 
2.简单将 redhat6.5 的 libaio.h 拷贝过来，编译报错（虽然 pam 源文件 /usr/include/security 拷贝过来编译可过，但是 libaio 就因为架构和版本的原因，不能随便找个 libaio.h 就完了）
 
3.想要安装 libaio-devel，出现以下问题：  
（1）apt 源没有 libaio-devel，只有 libaio1  
（2）Uos 中 libaio-devel 是否叫此名字？  
（3）对于 sw64 架构来说，libaio-devel 下载什么版本？在哪下载？
 
4.通过 apt show libaio1，可以查看 libaio 的版本为 0.3.1，发现 Homepage 指向了此组件的下载地址，从此地址能够通过 git clone 下载工具源码，然后切换分支 0.3.1，即取得了 libaio 的对应版本的源码（APT-Sources：/usr/lib/dpkg-db/status，记录了所有安装软件的详细安装信息）。
 
5.由于 libaio1 已经安装了，将缺失的源码拷贝到/usr/include，编译通过（不必非要安装 libaio-devel）。
    
# 四.ksh

ln -s /bin/sh /bin/ksh  
否则在 makeclient 报错找不到 /bin/ksh 工具
    
# 五.XSLT Error

## 1.问题

|   |   |
|---|---|
|报错信息来源|media.out|
|报错信息内容|(Location of error unknown)XSLT Error|
 
## 2.分析
 ![/usr/cm/n1ght1y_bu11d/cache/java/jdk/1inux_sw64/j2sdk-1mage/bin/java -cp "/opt/Insta11Anywhere/IA2011/resourc e/pa rsers /xmlpa rserAPIs. j ar : /opt/Insta11Anywhere/IA2011 / resou rce/pa rsers/xerceslmpl. j ar : /opt/Insta11Anywhe re/ IA2Ø11 /resource/xml.jar : /home/czy/code/1ds/vobs/tristarm/engadm/Insta11API/1ibAPI. jar" org.apache.xalan.xslt. Process -IN /home/czy/code/lds/vobs/trlstarm/sqldist_dls/etc/ids_master_doc.xml -XSL chgownergroup.xsl -PARAM platform Iinuxsw64 -PARAM edition Ultimate -PARAM component *basename GLS-JPN.ia_manifest .ia_manifest- -PAR AM action_list MANIFEST -PARAM product "GBase GLS" -OUT "GLS-JPN.ia_manifest" [ERR 06141 The (Location of error unknown)XSLT Error (javax. ml. transform. TransformerConfigurationExcept10n) : processor has encountered an Internal error condition. Please report the problem and provide the following information: Method not found: class = interface org.apache.xm1.ser1a1izer.Ser1a1izationHand1er method = addA- [class java . lang.String, int] ttributeContent args — Exception in thread "main" java . lang . RuntimeException: [ERR 0614] The processor has encountered an internal e r ror condition. Please report the problem and provide the following information: Method not found: class = i [class java. lang. nterface org.apache.m1.seria1izer.Seria11zationHand1er method = addAttributeContent args = String, int] at org.apache.xalan.xs1t.Process.doEx1t(Unknown Source) at org.apache.xalan.xs1t.Process.main(Unknown Source) make: [makefile: 170: GLS-JPN.ia—manifest] Error 1 (ignored) ](Exported%20image%2020250328135200-0.jpeg)  

本来以为是 serializer.jar 的问题，但是在重做 vm（尝试删除 serializer.jar 或 sun.jar）后，此问题并未解决。然后替换了新的 /opt/InstallAnywhere 下的 xml.jar 后通过。
   

## 3.解决

取 172.16.2.129 下的 /opt/InstallAnywhere 下的 xml.jar，替换后通过。
