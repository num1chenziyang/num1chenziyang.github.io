---
title: （实战）2.sw64-swos1.3.0
date: 2025-04-01 20:53:43
categories:
  - SDLC编译工作
  - 编译实战
tags:
  - 编译
password: 9761565829chen
toc: "true"
---
# （前言）机器详情

---

# （一）系统安装
申威：WX-H8000处理器，适配此处理器的系统SWOS-1.3.0-sw_64.iso，其实就是openEuler（华为欧拉系统）
 
## 一.制作镜像并安装（linux中制作镜像）
本系统必须在linux下使用dd命令制作：  
1) 格式化 U 盘；  
2) mkfs.ext3 /dev/sdb  
3) 制作安装 U 盘；  
4) dd if= SWOS-1.3.0-sw_64.iso of=/dev/sdb；  
5) 设置开机启动顺序，确保 U 盘或者光驱为第一启动顺序；  
6) 启动到安装盘，根据向导完成系统安装；  
7) 根据提示点击重启按钮重启系统；  
8) 输入安装过程中设置的用户名和密码可进入操作系统图形界面。
    
## 二.yum源配置

---

# （二）编译环境基本配置
## 1.按照编译环境配置手册，配置环境。  
（1）务必保证软件包安装完全，有很多问题都是因为缺少系统资源导致的。  
**见密网手册**

---

# （三）usrcm适配
## 1.合并WQY 对/usr/cm 提交
/usr/cm申威服务器适配的提交，合并后编译gls通过。


## 2.重做java
ids关于java报错。如果/usr/cm没有对新的架构进行适配，则新的架构需要重做 java 工具。重做方法见java工具重做

---

# （四）3.6.1_2代码适配
## 一.gls
合并WQY之前对申威服务器适配的提交，gls通过。 
编译更看重架构，系统不同但架构相同，大部分改动是通用的。


## 二.csdk
### 1.tristarm/setup/setup.linuxsw64
1.LINUX_SW64_CFLAGS  
添加-fcommon参数
 
2.THREADPROD=/usr/lib/libpthread.so.0  
修改此动态库为正确的系统库路径。

### 2.tristarm/setup/setup.linuxsw64.dev
1./setup.linuxsw64 "$@"  
修改此命令为正确的文件

### 3.tristarp/build/p-linuxsw64.sh
1.JDKHOME  
修改为重做完成的java目录
 
2.JAVAHOME  
修改为重做完成的java目录

csdk编译有一部分与ids编译类似，尤其是setup与build处，改动很多通用。


## 三.ids
### 1.tristarm/setup/setup.linuxsw64
1.LINUX_SW64_CFLAGS  
添加-fcommon参数
 
2.THREADPROD=/usr/lib/libpthread.so.0  
修改此动态库为正确的系统库路径。
 
3.JVP_JNI_CFLAGS="${ICFLAGS} -fcommon"  
（1）添加-fcommon参数，解决JVP编译模块报错重复定义问题。  
（2）加双引号，让语句生效。有时候会有不加双引号然后改动不生效的问题。

### 2.tristarm/setup/setup.linuxsw64.dev
1./setup.linuxsw64 "$@"  
修改此命令为正确的文件

### 3.tristarp/build/p-linuxsw64.sh
1.JDKHOME
修改为重做完成的java目录

### 4.tristarp/glsmscbe/glsextmt.c（aiostdio.h下移）
1.#include "../belib/aiostdio.h"下移

### 5.tristarp/belib/aiostdio.c（aiostdio.h下移）
1.#include "aiostdio.h"下移

### 6.tristarp/belib/mtex.c（ifdef中的#include未生效）
1.#include <asm/siginfo.h>写在ifdef之外  
由于ifdef中的#include未生效，导致函数未定义，将其写在外面。  
将其写在else最好，写在外面会出现定义两次情况，不太好。

### 7.tristarm/oslib/osdnet.c（ifdef中的#include未生效）
1.#include <sys/sysmacros.h>写在ifdef之外  
同上

### 8.tristarm/embed/ifxdeploy/makefile（gcc参数-llzma）
1.+llzma  
在长串gcc命令中，加入参数-llzma参数，以解决liblzma相关的报错

### 9.vobs/blade/timeseries/makeinc.6.linux（模块的gcc添加-fcommon）
1.CC = gcc -fcommon
 
Note：  
当添加编译参数后，命令没变化，有可能是下面几个原因：  
1.此处没有重新编，可以把此处文件单独清理了，再编。  
2.参数没加对地方，可以溯源，也可以多出添加（如CC、各种FLAG），力大砖飞。

### 10.vobs/blade/timeseries/src/Makefile（模块的gcc添加-fcommon）
1.CC、CFLAGS、LDFLAGS添加-fcommon  
同上

### 11.vobs/blade/excompat/src/utl_raw.c
1.删除inline  
解决inline报错，不必要加inline，详细调查见笔记：[inline](inline%E5%85%B3%E9%94%AE%E5%AD%97)  
此错误是在安装完ids后，查看log文件发现的，在加载bld文件的时候报错在inline。


## 四.share
### 1.tristarm/engadm/IA/install-prq/linuxsw64.prq
1.+/usr/lib/ld-linux.so.2￼搜索一下里面的库，若有的路径没有库文件，则在安装的时候报错缺少系统库。

---

# （END）总结
## 1.关于TSSTAGER
 
## 2.make：rm：Permission denied
系统的 rm 命令没问题，但是 makefile 中的 rm 操作失败。原因是工程配置的 rm 路径有误，导致没有找到正确的 rm 命令，此时在 setup 配置一下 rm 命令的正确路径。
 
## 3.未受托管文件与软链接文件
当 git log 没有内容的时候，不一定此文件不受托管，也许是一个软链接，注意一下。