# 一.SDS

## 1.用户info1

——————————————————————————————  
ROOTPATH ./dbs/rootdbs
 
MSGPATH $INFORMIXDIR/tmp/online.log.ids1  
CONSOLE $INFORMIXDIR/tmp/online.con.ids1
 
SERVERNUM 1  
DBSERVERNAME ids1_online_net  
NETTYPE soctcp,1,50,CPU
 
LTAPEDEV /dev/null
 
SDS_ENABLE 0  
##主备是两套不同的  
SDS_TEMPDBS sdstempdbs,/opt/info1/dbs/sdstempdbs,2,0,20000  
SDS_PAGING /opt/info1/dbs/page1,/opt/info1/dbs/page2  
UPDATABLE_SECONDARY 1  
——————————————————————————————
   

## 2.用户info2

——————————————————————————————  
ROOTPATH ./dbs/rootdbs   MSGPATH $INFORMIXDIR/tmp/online.log.ids2  
CONSOLE $INFORMIXDIR/tmp/online.con.ids2
 
SERVERNUM 2  
DBSERVERNAME ids2_online_net  
NETTYPE soctcp,1,50,CPU
 
LTAPEDEV /dev/null
 
SDS_ENABLE 1  
SDS_TEMPDBS sdstempdbs,/opt/info2/dbs/sdstempdbs,2,0,20000  
SDS_PAGING /opt/info2/dbs/page1,/opt/info2/dbs/page2  
UPDATABLE_SECONDARY 1  
——————————————————————————————
   

## 3.配置SQLHOSTS文件

sqlhosts文件位于${INFORMIXDIR}/etc/目录下，其内容应包含  
ids1_online_net onsoctcp rhel55 11801  
ids2_online_net onsoctcp rhel55 11802  
格式为：INFORMIXSERVER ServiceType Hostname/HostIP ServicePort
   

note:  
==1.====与====info1====的====onconfig.ids1====的区别在于====SERVERNUM====，====DBSERVERNAME====（区别不同的实例）==  
==2.====在====SDS====系统中，以下参数在整个系统中应该一致：====ROOTNAME====、====ROOTPATH====、====ROOTOFFSET====、====ROOTSIZE====、====PHYSDBS====、====PHYSFILE====、====LOGFILES== ==和== ==LOGSIZE==
 
参考网址： [https://blog.csdn.net/liaosnet/article/details/105766828](https://blog.csdn.net/liaosnet/article/details/105766828)
    
# 二.HDR

零基础配置HDR手顺  
Tips:  
一个集群中最多只能有一个 HDR辅节点。HDR 是一种将数据从主服务器复制到辅服务器的方法，基于逻辑日志的复制技术，所以数据库需要开启日志模式。  
HDR 主辅需要满足以下前提条件:主辅服务器的数据库版本完全相同主辅服务器的硬件和操作系统版本基本一致所有复制的数据库必须开启日志实例安装路径保持一致  
建议:主辅服务器硬件平台、操作系统完全相同。
   

1.修改配置文件  
1.修改sqlhosts文件，主备一致  
ol_hdr_pri onsoctcp 172.16.3.155 9761  
ol_hdr_sec onsoctcp 172.16.3.157 10024
   

hdr_group group - - i=10  
ol_hdr_pri onsoctcp 172.16.3.155 9761 g=hdr_group  
ol_hdr_sec onsoctcp 172.16.3.157 10024 g=hdr_group
   

注意，onconfig文件中DBSERVERALIASES如果已经配置，需要加入sqlhosts，否则起不来  
别名配置同上，端口号自选：netstat -anp | grep 9632
 
2.修改onconfig文件，主备一致  
ROOTNAME rootdbs  
ROOTPATH /home/Laura/hdr 54/storage/rootdbs  
ROOTOFFSET 0  
ROOTSIZE 1024000
 
PHYSFILE 189440  
PLOG_OVERFLOW_PATH $GBASEDBTDIR/tmp  
PHYSBUFF 512  
LOGFILES 18  
LOGSIZE 6144  
DYNAMIC_LOGS 2  
LOGBUFF 256
 
DRAUTO 1 HDR链接失败，备机转为标准状态，HDR链接成功，备机转为备机状态  
2 HDR链接失败，备机转主机，HDR链接成功，原主机转备机  
3 CM管理HDR  
0 HDR失败不自动切换服务器类型  
DRINTERVAL -1 //进行同步更新  
DRTIMEOUT 30  
UPDATABLE_SECONDARY 1 //备机可写开关
 
TAPEDEV $GBASEDBTDIR/backups  
LTAPEDEV $GBASEDBTDIR/backups
   

2.HDR  
1.主节点在online状态下执行：onmode -d primary ol_hdr_sec  
成功后使用onstat -g dri，状态为On-Line(Prim)。
 
2.关闭从节点：onmode -ky
 
3.主节点执行：ontape -s -L 0 -t STDIO | ssh 172.16.3.157 "source /home/czy/hdr/ol_hdr_sec.ksh && ontape -p -t STDIO"
 
4.从节点执行：onstat -g dri，状态为Fast Recovery
 
5.从节点执行：onmode -d secondary ol_hdr_pri，稍后状态变为Updatable(Sec)，若UPDATABLE_SECONDARY为0则状态为READ-ONLY(Sec)。
   

|   |   |
|---|---|
|onstat - -r 1|查看server状态，间隔1秒|
|onstat -D -r 1|查看dbs大小是否在增长，间隔1秒|
|onmode -d standary|主从分别执行，变为两个单机|
|HDR转为RSS|从节点：onmode -d RSS pri，再重启从节点|
|RSS转为HDR|从节点：onmode -d secondary pri|
|onstat -g dri|查看状态|
|onstat -g ath|查看线程状态|
|onstat -g smx||
|onstat -g cluster||