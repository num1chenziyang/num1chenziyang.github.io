---
title: 1.项目编译环境搭建
date: 2025-04-01 21:32:25
categories:
  - SDLC编译工作
  - 编译环境搭建
tags:
  - 编译
password: 9761565829chen
---
# （一）通用软件包安装

| 软件包名      | 说明                                                                                                                                                |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------- |
| bison     | 无                                                                                                                                                 |
| ksh       | 有的系统有 ksh，有的软链接到 sh，均可                                                                                                                            |
| flex      | 无                                                                                                                                                 |
| libx(X)11 | 同时需要 devel，即libX11-devel，下同                                                                                                                       |
| pam       | pam-devel                                                                                                                                         |
| elfutils  | elfutils-devel                                                                                                                                    |
| ncurses   | ncurses-devel                                                                                                                                     |
| libaio    | libaio-devel                                                                                                                                      |
| libuuid   | 对于 uuid.h 文件而言，下面两处都要有<br>/usr/include/uuid/uuid.h，/usr/include/uuid.h                                                                            |
| openssl   | 需要看数据库版本所需的 openssl 版本，<br>然后在/usr/cm里切换对应的分支即可，不必在系统中安装 openssl。                                                                                 |
| java      | 1.有的系统自带 java，有的不自带，有的甚至 iso 中就没有 java。<br>2.可以从同架构其他服务器中拷贝过来（通过 which java 溯源位置）。<br>3.做完 java 后，要做软链接/usr/bin/java，/usr/bin/jar，/usr/bin/javac。 |
| cmake     | 无                                                                                                                                                 |
| 其他        | 1.有可能在编译过程中遇见其他所依赖的软件未安装，这很正常。<br>2.对于特殊的架构，有时候 iso 文件中没有某软件，需源码编译安装。                                                                             |

---

# （二）InstallAnywhere 配置
## 一.从同架构机器取得 InstallAnywhere
```shell
scp -r /opt/InstallAnywhere root@ipv4:/opt
```

## 二.IA配置
```shell
##需要用到 213 的 docker 做 media
/opt/InstallAnywhere/IA2011/build -ls 10010@172.16.3.213
```
若执行此命令报 java 错，需要拿系统的 java 对InstallAnywhere中的 jre 进行重做：/opt/InstallAnywhere/IA2011/jre

## 三./root/.InstallAnywhere
```shell
vim /root/.InstallAnywhere/125/Enterprise/preferences/com.zerog.ia.Designer.properties
```
加入两行：
designer.path.manager.ia.project.enabled=false
designer.resource.manager.behavior=fail

---

# （三）cm配置
```shell
git clone 172.16.2.143上的gbase8s_usrcm库
mv gbase8s_usrcm cm
git checkout 对应分支
```

---

# （四）系统配置
## 一.~/.bashrc
向~/.bashrc中添加内容：
```text
export LANG=en_US.UTF-8
export PATH=${PATH}:/atria_release/cmbin:/atria_release/cmbin/mergescripts
```


## 二.代码目录下
```shell
cc ./ids/vobs/int_tools/engops/scripts/test_machine_setup/userid_l.c -o /usr/local/bin/userid
```


## 三.其他系统资源配置
```shell
ln -s /usr/bin/perl /usr/local/bin/perl
mkdir /clientsdk
adduser gbasedbt

mv /usr/bin/sudo /usr/bin/sudo.bak
##否则编译中会有一些命令的权限问题报错

scp -r /atria_release root@ipv4:/
##拷贝其他机器的到本机即可

ln -s /usr/bin/make /usr/bin/gmake
##若 gmake 本就存在，也正常

touch /usr/include/stropts.h
##编译 csdk 时可能会报错找不到这个文件，创一个空的即可

##Norule to make target 'oncmsm.iem', needed by 'mesg'. Stop
##此问题和编译环境相关，重新编译可以解决
```

---

# （五）vm工具重做（一般不用）
在 ids 编译的 media 阶段，报错找不到 vm 文件，导致 ids_install 等组件缺失，打包失败。  
如果在新的系统或架构未重做过 vm 工具，那么需要重做 vm 工具（java 虚拟机）。
`一般来说新架构才需要重做 vm，本人只在 AIX 新架构机器重做了 vm 并成功`
## 一.结构总览（/usr/cm 下）
```text
java
	jdk
		aix64（架构）
			jdk1.8（要替换的）
	jvms
		aix64（架构）
			IA_ibm_AIX.vm（要替换的）
```


## 二.重做 jdk（以 jdk1.8 为例）
### 1.拷贝系统的 java 的根目录
（1）可能不叫 jdk1.8，本系统就叫 java8_64；即包含 lib、include、bin、jre 的目录。  
这四个目录必须包含，也可能更多，否则肯定是依赖包没装全，如openssl-devel 等。  
（2）可以通过 which java 来找到。
 
### 2.将 sun.jar、serializer.jar 做入 jdk
jdk1.8/jre/lib/ext/sun.jar  
jdk1.8/jre/lib/sun.jar  
jdk1.8/lib/ext/sun.jar  
jdk1.8/lib/sun.jar  
（seriaizer.jar 同理）


## 三.重做 jvms
### 1.mkdir jre
 
### 2.将 jdk1.8 下的 jre 拷贝到自建的 jre 中
此时 jre 是双层的，即 jre/jre/******
 
### 3.制作 vm.tar.Z
命令：**tar -Zcvf vm.tar.Z jre**
note：有的系统虽然可以 tar -Zcvf 打包，但是打包出来的文件在 gunzip 时失败。  
AIX7.1 即是如此，可以 scp 到 129 服务器打包，再粘回去。
 
### 4.制作 vm 包
命令：**zip IA_ibm_AIX.vm META-INF vm.properties vm.tar.Z**
note：jys 没有把META-INF打包进去，没有影响。


## 四.替换资源
（1）/usr/cm/nightly_build/cache/java/jdk/aix64/jdk1.8  
（2）/usr/cm/nightly_build/cache/java/jvms/aix64/IA_ibm_AIX.vm  
（3）/opt/InstallAnywhere/IA2011/resource/installer_vms/IA_ibm_AIX.vm  
note：这些路径、目录、文件名，配置在 build 下的脚本中，在 tristarm 下 grep 也能搜的到。适配新平台时往往需要重做 cm 下的 java 工具，可以参考一下此类提交。

---
