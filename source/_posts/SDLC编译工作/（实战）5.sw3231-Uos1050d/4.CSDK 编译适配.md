# 一.libthasf.a 创建失败（asf 目录）

## 1.问题

|   |   |
|---|---|
|报错信息来源|makedevsdk.out|
|报错信息内容|libthasf.a 创建失败|
|报错初步分析|asf 目录下 thread/al.o 与 th_shared/al.o 缺失，导致 libthasf.a 创建失败|
 
## 2.分析

tristarm/setup/setup.linuxsw64 文件中，THREADPROD 参数指向的 libpthread.so 文件未找到，导致 makefile 中 if 判断 THREADPROD -f 不存在，故没有走创建多线程的 al.o 流程。
 
## 3.解决

找到系统的 libpthread.so，将 THREADPROD 改对即可。
 
## 4.经验

此处是在 makefile 中，发现创建 al.o 的 if 判断失败。下面的 esqlc 问题和此问题相同，都是系统的 so 未找到，导致脚本中的 if 判断失败。这里是 makefile 脚本，下面是 esql 脚本。当只看脚本不能定位问题时，可以在编译过程中调试脚本，添加 set -x 命令，在 out 文件中一步一步看就行。
    
# 二.undefined references to 'ifx_sqlcode' follow

## 1.问题

|   |   |
|---|---|
|报错信息来源|makedevsdk.out|
|报错信息内容|# undefined references to 'ifx_sqlcode' follow|
|报错初步分析||
 
## 2.分析

搜函数 ifx_sqlcode 在哪，找到此函数的 c 文件，是 sqli/iqdiag.c，对 iqdiag.o 使用 nm 命令，发现确实没有定义 ifx_sqlcode 函数。此时问题就很明显了，在此函数上面有条件#ifdef IFX_THREAD，说明此宏未生效。
 
此宏未生效的原因是，编译的时候未加或删除了-thread 选项（曾为了解决 esqlc 问题，将-thread 改为-pthread，这是不正确的，应是新加入-pthread 或者-lpthread 等其他解决方法），将 -thread 选项恢复。
 
## 3.解决

见下述 esqlc 问题
      

# 三.esqlc 问题

tristarm/setup/setup.linuxsw64 文件中，SYSTHDIR 参数配置的是 /usr/lib，esql.sh 脚本会使用此参数拼接 libpthread.so 的路径，即 /usr/lib/libpthread.so。然而 Uos1050d_sw64 系统的 libpthread.so 是/usr/lib/sw_64-linux-gnu/libpthread.so，导致 -f 判断 libpthread.so 失败，esqlc 执行报错。
 
## 经验

1.set -x 调试 esql 脚本，去寻找里面不对的路径和逻辑。  
2.不要怀疑工具的问题，一般来说就是什么工具没装上，什么 so 路径没有直到。
    
# 四.infxmsg

tristarm/em/infxmsg 下编出来之后放入 /usr/bin 下即可，否则 esql 报错找不到 infxmsg 工具。
    
# 五.字符集问题