---
title: 1.NQA测试工具
date: 2025-04-15 14:26:08
categories:
  - SDLC测试工作
  - UTM
tags: []
password: 9761565829chen
---
# （一）NQA工具结构
## 一.静默安装路径
将ids，csdk，jdbc做入此目录
```text
/home/czy/instance-nqa
```


## 二.UTM工具
/work/workiqa：workiqa是受git托管目录

| 目录名称       |     |
| ---------- | --- |
| cdrtools   |     |
| inst       |     |
| report     |     |
| report_bak |     |
| rerunlist  |     |
| run_git    |     |
| testlist   |     |
| utm        |     |


## 三.个人文件配置
### 1.run_git总览
<1>single_test.sh：单跑用例
```shell
sh single_test.sh /vobs/chenziyang/test.tdl
```

<2>list_test.sh：全跑用例，多实例（并发）
```shell
sh list_test.sh /home/czy/all_list
```

<3>list_test_single.sh：全跑用例，单实例
```shell
sh list_test_single.sh /home/czy/all_list
```

### 2.修改个人的配置文件
#### 1.single_test.sh
```text
java1：系统的java可执行程序。如：/usr/java/jdk1.6.0_20/bin/java

jar1：指定到utm下的eclipse的jar包。

config1：指定到自己特定的配置文件。如：/work/workiqa/utm/IQA1210_czy_362.cfg
```

#### 2.IQA1210_czy_362.cfg
```text
GBASEDBTDIR指向静默安装目录。如：/home/czy/instance-nqa/sqldist

其他参数都指向相关的目录。
如：
/home/czy/instance-nqa/dbspaces
/home/czy/instance-nqa/jdbc
......

HOSTNAME：修改为机器IP，在拷贝到其他服务器的时候记得改。
```


## 四.遇见的问题
### 1.UTM工具版本问题
跑用例的时候大量的java报错，或者跑不起来，此时应怀疑：
```shell
（1）UTM工具版本问题。
（2）UTM工具的资源损坏。
（3）配置文件指向的UTM文件不存在。
（4）大写问题需重做 jdbc（见 151 实战）。
（5）服务器密码更改（见 151 实战）。
```

---

# （二）NQA环境部署
## 一.前提条件
### 1.java版本
```shell
##java版本至少是1.6
java -version
```

### 2.git版本
```shell
##git版本至少是2.0
git --version
```

### 3.服务器名
```shell
##机器名应设为ip地址，否则装不上（不一定，最好机器名是ip地址）
uname -n

##此命令暂时修改主机名，重启后主机名还是配置文件里的名
hostname 172.16.2.141

##将首行的ip改成本机的ip（改动此文件后需重启服务器）
vim /etc/hosts
```


## 二.UTM环境部署
~~（##曾经的制作方法，现在不这么做了）~~
~~1.解压工具包~~
~~tar -xvf tools-utm_env.tar~~
~~2.运行脚本，自动部署环境~~
~~cd tools-utm_env~~
~~sh run.sh~~
~~注意，vim run.sh，其调用了两个脚本文件，作用是将远端的UTM框架拉取到本地，将其涉及用户名密码文件修改为：http://ci_user:test12345678………………..~~

### 1.系统工具检查与重做
看一下，没有就加上，有就不用做了
#### <1>userid
```shell
cp -rp userid/userid-X86_64 /bin/userid

chmod 6755 /bin/userid

cp userid/userid-ARM /bin/userid

chmod 6755 /bin/userid
```

#### <2>java
```shell
##不管前面是java什么版本，此路径不改：/usr/java/jdk1.6.0_20
ln -s /usr/lib/jvm/java-1.6.0-openjdk-1.6.0.0.x86_64 /usr/java/jdk1.6.0_20

echo "export JAVA_HOME=/user/java/jdk1.6.0_20; export PATH=\$JAVA_HOME/bin:\$PATH" >>/etc/profile
```

#### <3>最大文件开启数量限制
```shell
echo "* - nofile 65536" >>/etc/security/limits.conf
```

#### <4>git 源码编译安装（若 git 版本小于 2.0）
```shell
redhat6.2自带的git1.7版本无法正常使用，需要安装git2.0.0

安装git依赖的库：curl、zlib、openssl、expat、libiconv

查看库是否安装：
rpm qa | grep *curl*
rpm qa | grep *zlib*
rpm qa | grep *openssl*
rpm qa | grep *expat*
rpm qa | grep *libiconv*

库资源在172.16.2.141：/home/Packages

安装.rpm文件命令：  
rpm -ivh xxxxx（很容易碰见各种依赖情况）

在141的NQA部署中，git在make all时报hmac.h，将报错处注掉后通过且无影响。

以上库无需重新安装，redhat6.2自带的库可以支持git2.0.0成功安装。
```

### 2.sh setenv_utm.sh
```shell
##进入nqa_make（资源都在172.16.2.151 的/home/wqy/NQA_env_make下）

##创建nqa用户组
sh setenv_utm.sh
```

### 3.制作 /work/workiqa
```text
将 workiqa 工具从 git 上拉下来，创建软链接 /work/workiqa 指向 workiqa（大约 5.9G，有时候根目录大小紧张，就把 workiqa 放到 home 下，然后/work/workiqa 软链接过来）
```

### 4.查看 gettc_install.sh 脚本
```text
位于/work/workiqa/run_git/gettc_install.sh（跟着脚本中的步骤一步一步执行即可）

<1>做 vobs：clone，权限，软链接
<2>做/UTM
```

---

# （三）NQA使用流程（ old）
## 1. 手动部署流程
```bash
# 1.1 静默安装IDS
./ids_install -i silent -DLICENSE_ACCEPTED=TRUE -DUSER_INSTALL_DIR=/home/czy/test

# 1.2 静默安装CSDK
./installclientsdk -i silent -DLICENSE_ACCEPTED=TRUE -DUSER_INSTALL_DIR=/home/czy/test

# 1.3 拷贝JDBC驱动
cp -r /home/wqy/JDBC/350/jdbc /home/czy/test

# 1.4 软链接配置
rm /opt/gbase8siqa  # 删除旧链接（需确认无其他依赖）
ln -s /home/czy/test /opt/gbase8siqa  # 建立新软链接

# 1.5 进程检查与清理
ps -ef | grep oninit  # 检查数据库进程
ps -ef | grep NQA     # 检查测试进程
# 若需强制清理环境：
cd /work/workiqa/run_git
./clean_env.sh        # 清理残留环境
./kill_oninit_gbasedbt.sh  # 终止数据库进程

# 1.6 切换代码分支（非必须）
cd /vobs
git checkout 350-ora  # 切换到指定测试分支

# 1.7 UTM工具解压
cd /work/workiqa/utm
unzip 340utm.zip -A  # 解压测试工具包

# 1.8 启动总测试
./work/workiqa/run_git/runloop_NQA.sh  # 执行主测试脚本

# 1.9 实时日志监控
tail -f /tmp/IQAtest.log  # 动态查看测试日志
```


## 2. 脚本部署（简化流程）
```bash
# 2.1 环境初始化（谨慎操作）
nqa命令    # 具体脚本未提供，需根据实际定义
kk清理内存 # 注意：多人共用服务器时避免执行，可能导致服务中断

# 2.2 依赖包准备
# 需提前将CSDK与IDS安装包按脚本要求存放至指定目录
```


## 3. 测试结果分析
```bash
# 3.1 结果集目录定位
路径示例：/work/workiqa/report_bak/945486189-15185  # 根据测试编号查找

# 3.2 错误用例批量重跑
# 步骤：
# 1. 将失败用例列表（fail_NQA_testlist）复制到指定目录
cp /work/workiqa/report_bak/.../fail_NQA_testlist /work/workiqa/run_git/fail_wqy
# 2. 执行重跑脚本
./test_wqy.sh

# 3.3 单个错误用例重跑
userid sqlqa ./single_test.sh  # 需替换为具体用户和用例参数
```


## 4. 常用操作记录
```bash
utmi
# 进入环境变量配置目录（/UTM/IDS/IQA1210/dbspaces/atmo101）
# 功能：检查数据库运行状态，适用于静默安装及NQA测试环境
```

---

# （四）NQA 新功能
## 1.xnqa 351
```text
使用方法（以 351 版本举例）
（1）将 ids，csdk（jdbc 有无均可）放入目录
（2）执行命令：xnqa 351
（3）执行完此命令后，会有如下效果：

note:
<1>如果没有 jdbc 会自动补充同版本 jdbc。
<2>自动安装 ids，csdk，jdbc 在同级目录下，自动切换 /vobs 分支，开始测试。
<3>跑完后会给出结果目录，以供查看结果。
```


## 2.xrun
```
xrun /vobs/chenziyang/test.tdl

即是执行：sh /work/workiqa/run_git/single_test.sh /vobs/chenziyang/test.tdl
```