---
title: LVM的核心概念​
date: 2025-04-09 11:47:34 
categories: 
- SDLC机器支持
- 
tags: 
- 
password: 
---
### **一、LVM 的核心概念**
#### **1. 物理卷（Physical Volume, PV）**
• **定义**：物理磁盘或分区（如 `/dev/sdb`、`/dev/sdc1`），经过 `pvcreate` 命令初始化为 LVM 可管理的存储单元。
• **作用**：作为 LVM 的底层物理存储资源，类似于传统分区的“砖块”。

#### **2. 卷组（Volume Group, VG）**
• **定义**：由多个物理卷（PV）组成的**存储池**，可以动态扩展或缩减。
• **作用**：整合多个物理卷的存储空间，形成一个统一的资源池，供逻辑卷使用。

#### **3. 逻辑卷（Logical Volume, LV）**
• **定义**：从卷组（VG）中划分出的虚拟磁盘分区，可直接格式化和挂载使用。
• **作用**：类似于传统分区，但支持动态调整大小、快照等高级功能。

#### **4. 物理扩展（Physical Extent, PE）**
• **定义**：LVM 的最小存储单元（默认 4MB），物理卷和逻辑卷的空间均按 PE 划分。
• **作用**：简化存储空间的分配和管理。

---

### **二、LVM 的层次关系**
```
物理磁盘或分区 → 物理卷（PV） → 卷组（VG） → 逻辑卷（LV） → 文件系统
```
• **物理卷（PV）** 是存储的物理基础。
• **卷组（VG）** 整合多个 PV 的空间。
• **逻辑卷（LV）** 从 VG 中划分，最终承载文件系统。

---

### **三、LVM 操作命令大全**
#### **1. 物理卷（PV）操作**
• **初始化物理卷**：
  ```bash
  pvcreate /dev/sdb  # 将 /dev/sdb 初始化为 PV
  ```
• **查看物理卷信息**：
  ```bash
  pvs          # 简要信息
  pvdisplay    # 详细信息
  ```
• **删除物理卷**：
  ```bash
  pvremove /dev/sdb  # 清除 PV 属性
  ```

#### **2. 卷组（VG）操作**
• **创建卷组**：
  ```bash
  vgcreate myvg /dev/sdb /dev/sdc  # 使用两个 PV 创建名为 myvg 的卷组
  ```
• **扩展卷组**（添加新 PV）：
  ```bash
  vgextend myvg /dev/sdd  # 将 /dev/sdd 添加到 myvg
  ```
• **缩减卷组**（移除 PV）：
  ```bash
  vgreduce myvg /dev/sdd  # 从 myvg 中移除 /dev/sdd（需确保 PV 未被使用）
  ```
• **查看卷组信息**：
  ```bash
  vgs          # 简要信息
  vgdisplay    # 详细信息
  ```

#### **3. 逻辑卷（LV）操作**
• **创建逻辑卷**：
  ```bash
  lvcreate -n mylv -L 20G myvg  # 在 myvg 中创建 20GB 的 LV，命名为 mylv
  ```
  • `-n`：指定逻辑卷名称。
  • `-L`：指定大小（如 `10G`、`500M`）。
• **格式化并挂载 LV**：
  ```bash
  mkfs.ext4 /dev/myvg/mylv       # 格式化为 ext4
  mount /dev/myvg/mylv /mnt      # 挂载到 /mnt
  ```
• **扩展逻辑卷**（在线扩容）：
  ```bash
  lvextend -L +10G /dev/myvg/mylv  # 增加 10GB
  resize2fs /dev/myvg/mylv         # 调整文件系统（ext4）
  ```
  • 对 xfs 文件系统使用 `xfs_growfs /mnt`。
• **缩减逻辑卷**（需卸载且谨慎操作）：
  ```bash
  umount /mnt
  e2fsck -f /dev/myvg/mylv        # 检查文件系统
  resize2fs /dev/myvg/mylv 15G    # 调整文件系统到 15G
  lvreduce -L 15G /dev/myvg/mylv  # 缩减 LV 到 15G
  mount /dev/myvg/mylv /mnt
  ```
• **删除逻辑卷**：
  ```bash
  lvremove /dev/myvg/mylv
  ```

#### **4. 查看逻辑卷信息**
```bash
lvs          # 简要信息
lvdisplay    # 详细信息
```

---

### **四、LVM 高级功能**
#### **1. 快照（Snapshot）**
• **创建快照**（保留 LV 某一时刻的状态）：
  ```bash
  lvcreate -s -n snap_mylv -L 5G /dev/myvg/mylv
  ```
  • `-s`：创建快照。
  • 快照大小需足够存储原 LV 的变更数据。

#### **2. 迁移数据（PV 间移动）**
```bash
pvmove /dev/sdb /dev/sdc  # 将数据从 /dev/sdb 迁移到 /dev/sdc
```

---

### **五、LVM 的优势**
1. **动态调整**：在线扩展/缩减逻辑卷和卷组。
2. **存储池化**：整合多个磁盘或分区的空间。
3. **快照功能**：备份和恢复更灵活。
4. **条带化/镜像**：支持 RAID 类似功能。

---

### **六、示例操作流程**
#### **场景**：将 `/dev/sdb` 和 `/dev/sdc` 合并为一个卷组，并创建动态扩展的逻辑卷。
1. **创建物理卷**：
   ```bash
   pvcreate /dev/sdb /dev/sdc
   ```
2. **创建卷组**：
   ```bash
   vgcreate myvg /dev/sdb /dev/sdc
   ```
3. **创建逻辑卷**：
   ```bash
   lvcreate -n mylv -L 50G myvg
   ```
4. **格式化和挂载**：
   ```bash
   mkfs.ext4 /dev/myvg/mylv
   mount /dev/myvg/mylv /mnt
   ```
5. **扩展逻辑卷**（当空间不足时）：
   ```bash
   lvextend -L +10G /dev/myvg/mylv
   resize2fs /dev/myvg/mylv
   ```

---

### **七、注意事项**
6. **备份数据**：操作 LVM 前建议备份重要数据。
7. **在线调整限制**：某些操作（如缩减文件系统）需卸载 LV。
8. **兼容性**：LVM 配置可能需在内核中预先启用。

通过 LVM，您可以更灵活地管理存储空间，适应服务器和大型存储环境的需求。