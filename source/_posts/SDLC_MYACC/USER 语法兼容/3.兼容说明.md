CREATE USER opt_if_not_exists create_user_list default_role_clause  
require_clause connect_options  
opt_account_lock_password_expire_options  
opt_user_attribute
 
# 一.opt_if_not_exists

## 1.Mysql：

略
 
## 2.gbase：

支持
    
# 二.create_user_list

## 1.Mysql：

略
 
## 2.gbase：

支持
 
note：  
1.mysql 支持 user_list，即可以一条命令创建多个 user，如：  
CREATE USER 'john'@'localhost' IDENTIFIED BY 'password123', 'alice'@'%' IDENTIFIED BY 'securepassword';  
gbase 不支持，追溯到处理代码，并没有处理多个用户的循环，YYERROR。
 
2.mysql 支持 user@host 的写法，如：  
CREATE USER 'john'@'localhost' IDENTIFIED BY 'password123';  
gbase 不支持，YYERROR。
    
# 三.default_role_clause

## 1.Mysql：

假设我们有一个 MySQL 数据库，其中包含几个不同的角色，分别是 developer, dba, 和 analyst。每个角色都有特定的权限集合。现在我们要创建一个新的用户 john 并为他设置默认角色为 developer。这意味着每当 john 登录时，他的 developer 角色会自动激活，无需额外操作。
 
步骤 1：创建角色（如果尚未创建）  
首先，确保这些角色已经存在：  
==CREATE ROLE== =='developer'====;====￼====CREATE ROLE== =='dba'====;====￼====CREATE ROLE== =='analyst'====;==
 
步骤 2：授予角色权限  
接下来，为每个角色授予相应的权限。这里仅以 developer 为例：  
==GRANT SELECT, INSERT, UPDATE ON mydatabase.* TO== =='developer'====;==  
你可以根据需要为其他角色授予不同的权限。
 
步骤 3：创建用户并分配角色  
然后，创建新用户 john 并分配 developer 角色给他：  
==CREATE USER== =='john'====@===='localhost'== ==IDENTIFIED BY== =='password123'====;====￼====GRANT== =='developer'== ==TO== =='john'====@===='localhost'====;==
 
步骤 4：设置默认角色  
现在，我们将 developer 设置为 john 的默认角色：  
==ALTER USER== =='john'====@===='localhost'====￼====DEFAULT== ==ROLE== =='developer'====;==  
或者，在创建用户时直接指定默认角色：  
==CREATE USER== =='john'====@===='localhost'== ==IDENTIFIED BY== =='password123'====￼====DEFAULT== ==ROLE== =='developer'====;==
 
验证效果  
为了验证 john 登录时是否自动激活了 developer 角色，可以使用以下步骤：

1. 登录：￼==mysql -u john -p==
2. 检查当前激活的角色：￼==SELECT== ==CURRENT_ROLE====()====;==

你应该看到输出显示 developer 是当前激活的角色。
 
演示额外操作  
如果你想展示 john 不需要额外操作即可访问由 developer 角色授权的资源，可以尝试执行一些受限制的操作，比如查询数据库中的表：  
==SELECT *== ==FROM== ==mydatabase.some_table;==  
由于 developer 角色已经被授予了对 mydatabase 的 SELECT 权限，john 应该能够成功执行上述查询，而不需要手动激活任何角色。
 
总结  
通过将 developer 设置为 john 的默认角色，每当 john 登录时，他的 developer 角色都会自动激活，允许他立即开始工作，而不需要进行额外的角色激活步骤。这不仅简化了用户的操作流程，也提高了工作效率。
 
## 2.gbase：

与此相关的语法：创建缺省用户（详见[数据库内部用户权限演示](1.gbase8s_create_user%20%E8%AF%AD%E6%B3%95%E7%BB%BC%E8%BF%B0)）  
CREATE DEFAULT USER WITH PROPERTIES USER "tmp";
 
## 3.对比：

gbase 方式可以通过先创建 default user，然后 create user 实现。  
但是这会带来事务方面的问题，如果第一句执行成功，第二句执行失败，那么算成功算失败？  
所以此类需要多句才能实现的功能暂时都不予支持，先记录，后续有需要再看看如何支持。
    
# 四.require_clause

## 1.Mysql：

require_clause 是 CREATE USER 语句的一部分，用于指定连接到服务器时用户必须满足的 SSL 或 X509 安全要求。这可以确保只有通过特定的安全协议或证书验证的客户端才能成功连接到数据库服务器。  
此功能 gbase 不支持。
 
==语法==  
==require_clause== ==的基本语法如下：==  
==REQUIRE== =={ NONE | SSL | X509 | CIPHER== =='cipher'== ==| ISSUER== =='issuer'== ==| SUBJECT== =='subject'== ==}==

- ==NONE====：表示不需要任何特殊的安全要求。==
- ==SSL====：要求连接必须使用 SSL 加密。==
- ==X509====：要求连接必须使用 X509 证书进行身份验证。==
- ==CIPHER 'cipher'====：指定使用的加密算法（例如 AES128-SHA）。==
- ==ISSUER 'issuer'====：指定证书颁发者的 DN（Distinguished Name）。==
- ==SUBJECT 'subject'====：指定客户端证书的主题 DN。==

==你可以组合多个选项，例如同时要求 SSL 和特定的 X509 属性。==
 
==示例==  
==要求 SSL 连接==  
==创建一个用户并要求该用户必须使用 SSL 连接到服务器：==  
==CREATE USER== =='secureuser'====@===='localhost'== ==IDENTIFIED BY== =='password123'====￼====REQUIRE== ==SSL;==
 
==要求 X509 证书==  
==创建一个用户并要求该用户必须使用 X509 证书进行身份验证：==  
==CREATE USER== =='certuser'====@===='localhost'== ==IDENTIFIED BY== =='password123'====￼====REQUIRE== ==X509;==
 
==指定特定的 SSL 属性==  
==创建一个用户，并指定具体的 SSL 属性，如加密算法、证书颁发者和主题：==  
==CREATE USER== =='specificuser'====@===='localhost'== ==IDENTIFIED BY== =='password123'====￼====REQUIRE== ==SSL CIPHER== =='AES128-SHA'== ==ISSUER== =='/C=US/O=MySQL/CN=MySQL Root CA'== ==SUBJECT== =='/C=US/ST=California/L=San Francisco/O=MySQL/OU=Engineering/CN=MySQL Server'====;==
 
==注意事项==

- ==使用== ==REQUIRE== ==子句时，确保你的 MySQL 服务器已经配置了 SSL 支持，并且客户端也支持相应的安全设置。==
- ==如果你在创建用户时指定了 SSL 或 X509 相关的要求，但客户端不支持这些安全特性，则连接尝试将失败。==
- ==REQUIRE== ==子句中的选项不是所有情况下都可以一起使用；某些组合可能会导致冲突或无效配置。请参考 MySQL 文档以了解具体的支持情况。==

通过这种方式，require_clause 提供了一种强大的机制来增强 MySQL 数据库连接的安全性，确保只有符合特定安全标准的客户端能够访问数据库。
 
## 2.gbase：

不支持
    
# 五.opt_account_lock_password_expire_options

## 1.Mysql：

用于管理和控制用户账户的状态以及密码的生命周期。这部分可以设置账户是否锁定、密码是否过期等选项，从而增强数据库的安全性和管理灵活性。  
==opt_account_lock_password_expire_options 的作用==

- ==ACCOUNT { LOCK | UNLOCK }：指定新创建的用户账户是否在创建时被锁定。锁定的账户无法登录，直到管理员解锁。==
- ==PASSWORD EXPIRE { DEFAULT | NEVER | INTERVAL N DAY }：定义新创建用户的密码何时过期。这有助于强制用户定期更改密码，提高安全性。==
 
==语法==  
==[ACCOUNT { LOCK | UNLOCK }]====￼====[PASSWORD EXPIRE {== ==DEFAULT== ==| NEVER | INTERVAL N DAY }]==
 
==示例==  
==创建一个锁定账户==  
==假设你想创建一个名为== ==john== ==的用户，并且希望该账户在创建时被锁定：==  
==CREATE USER== =='john'====@===='localhost'== ==IDENTIFIED BY== =='password123'====￼====ACCOUNT LOCK;==  
==在这个例子中，====john== ==的账户将被立即锁定，他无法使用此账户登录，直到管理员解锁。==  
==设置密码永不过期==  
==如果你希望创建一个用户的密码永远不会过期，可以这样做：==  
==CREATE USER== =='alice'====@===='localhost'== ==IDENTIFIED BY== =='securepassword'====￼====PASSWORD EXPIRE NEVER;==  
==在这个例子中，====alice== ==的密码将永远不会过期，她不需要定期更改密码。==  
==设置密码定期过期==  
==如果你想让用户的密码在创建后的一段时间后过期，可以指定一个过期间隔。例如，设置密码在创建后的90天后过期：==  
==CREATE USER== =='bob'====@===='localhost'== ==IDENTIFIED BY== =='anotherpassword'====￼====PASSWORD EXPIRE INTERVAL== ==90== ==DAY;==  
==在这个例子中，====bob== ==的密码将在创建后的90天后过期，他需要在此之后更改密码才能继续使用账户。==  
==结合使用账户锁定和密码过期策略==  
==你可以结合使用账户锁定和密码过期策略来创建更安全的用户账户：==  
==CREATE USER== =='manager'====@===='localhost'== ==IDENTIFIED BY== =='managerpassword'====￼====ACCOUNT LOCK====￼====PASSWORD EXPIRE INTERVAL== ==60== ==DAY;==  
==在这个例子中，====manager== ==的账户将被锁定，并且他的密码将在创建后的60天后过期。管理员需要先解锁账户，并通知用户在首次登录时更改密码。==  
==注意事项==

- ==使用== ==ACCOUNT LOCK== ==可以防止新创建的账户立即被使用，这对于确保账户在正式启用前已经经过适当的配置和审核非常有用。==
- ==密码过期策略可以帮助确保用户定期更新密码，从而提高安全性。但过于频繁的密码更改可能会给用户带来不便，因此应根据实际情况合理设置。==
- ==如果你使用的是 MySQL 5.7 或更高版本，这些选项是可用的；对于更早的版本，某些功能可能不可用或行为不同。==

通过这种方式，opt_account_lock_password_expire_options 提供了一种强大的工具来管理用户账户的安全性和生命周期，确保数据库系统的安全性和合规性。
 
## 2.gbase：

对 ACCOUNT LOCK 和 ACCOUNT UNLOCK 支持，对 password 的期限不支持。
    
# 六.connect_options

## 1.Mysql：

在 MySQL 中，connect_options 是 CREATE USER 语句的一部分，用于指定与用户连接相关的一些特殊选项。这些选项可以控制用户连接到数据库服务器时的行为，包括资源限制、连接特性等。通过 connect_options，管理员可以更精细地管理用户连接的各个方面，以确保系统的安全性和性能。
 
==connect_options== ==主要用于设置用户的资源限制和其他连接属性。它可以包含以下几种子句：==

- ==MAX_QUERIES_PER_HOUR：每小时允许的最大查询数。==
- ==MAX_UPDATES_PER_HOUR：每小时允许的最大更新操作数。==
- ==MAX_CONNECTIONS_PER_HOUR：每小时允许的最大连接数。==
- ==MAX_USER_CONNECTIONS：该用户同时允许的最大连接数。==

==这些选项可以帮助防止某个用户消耗过多的服务器资源，从而影响其他用户的使用体验。==
 
==语法==  
==connect_options== ==的基本语法如下：==  
==[RESOURCE LIMIT]====￼== ==MAX_QUERIES_PER_HOUR count====￼== ==MAX_UPDATES_PER_HOUR count====￼== ==MAX_CONNECTIONS_PER_HOUR count====￼== ==MAX_USER_CONNECTIONS count==  
==每个选项都是可选的，并且你可以根据需要组合多个选项。==
 
==示例==  
==设置每小时最大查询数和更新数==  
==创建一个用户并限制其每小时最多执行 100 次查询和 50 次更新：==  
==CREATE USER== =='limiteduser'====@===='localhost'== ==IDENTIFIED BY== =='password123'====￼====WITH MAX_QUERIES_PER_HOUR== ==100====￼== ==MAX_UPDATES_PER_HOUR== ==50====;==
 
==设置每小时最大连接数==  
==创建一个用户并限制其每小时最多建立 20 次连接：==  
==CREATE USER== =='limitedconnuser'====@===='localhost'== ==IDENTIFIED BY== =='password123'====￼====WITH MAX_CONNECTIONS_PER_HOUR== ==20====;==
 
==设置最大用户连接数==  
==创建一个用户并限制其同时最多有 5 个连接：==  
==CREATE USER== =='multiuser'====@===='localhost'== ==IDENTIFIED BY== =='password123'====￼====WITH MAX_USER_CONNECTIONS== ==5====;==
 
==组合多个限制==  
==创建一个用户并组合多个连接限制：==  
==CREATE USER== =='restricteduser'====@===='localhost'== ==IDENTIFIED BY== =='password123'====￼====WITH MAX_QUERIES_PER_HOUR== ==100====￼== ==MAX_UPDATES_PER_HOUR== ==50====￼== ==MAX_CONNECTIONS_PER_HOUR== ==20====￼== ==MAX_USER_CONNECTIONS== ==5====;==
 
==注意事项==

- ==使用== ==connect_options== ==可以帮助管理员更好地控制用户行为，但过严的限制可能会影响用户的正常使用。==
- ==这些限制是基于时间（每小时）的，因此它们会周期性地重置。==
- ==如果你需要更改现有用户的连接选项，可以使用== ==ALTER USER== ==语句来修改这些设置。==

通过这种方式，connect_options 提供了一种灵活的方法来管理用户连接行为，确保数据库资源得到合理分配，同时也提高了系统的稳定性和安全性。
 
## 2.gbase：

不支持
    
# 七.opt_user_attribute

## 1.Mysql：

opt_user_attribute 是 MySQL CREATE USER 语句的一部分，用于为用户设置额外的属性信息。这些属性可以包含用户的元数据，如姓名、组织等，具体支持取决于 MySQL 的版本。从 MySQL 8.0 开始，opt_user_attribute 可以通过 JSON 格式来存储用户属性，这为用户管理提供了更多的灵活性和上下文信息。
 
==opt_user_attribute 的作用==  
==opt_user_attribute== ==允许管理员在创建或修改用户时附加一些非认证相关的元数据信息。这些信息可以用于记录用户的相关背景信息，帮助管理员更好地管理和识别用户账户。例如，你可以记录用户的真实姓名、部门、职位等信息。==
 
==语法==  
==[ATTRIBUTE== =='{"key": "value", ...}'====]==

- ==ATTRIBUTE====：关键字，表示接下来是一个 JSON 对象。==
- =='{"key": "value", ...}'====：JSON 格式的字符串，包含一个或多个键值对，每个键值对代表一个用户属性。==
 
==示例==  
==创建带有属性的用户==  
==假设你想创建一个名为== ==john== ==的用户，并附带一些元数据信息：==  
==CREATE USER== =='john'====@===='localhost'== ==IDENTIFIED BY== =='password123'====￼====ATTRIBUTE== =='{"name": "John Doe", "department": "Engineering", "position": "Software Developer"}'====;==  
==在这个例子中：==

- ==john== ==的账户被创建，并且附加了三个属性：====name====（真实姓名）、====department====（部门）和== ==position====（职位）。==
 
==修改现有用户的属性==  
==如果你想要更新现有用户的属性，可以使用== ==ALTER USER== ==语句：==  
==ALTER USER== =='john'====@===='localhost'====￼====ATTRIBUTE== =='{"name": "John Doe", "department": "Engineering", "position": "Senior Software Developer"}'====;==  
==在这个例子中：==

- ==john== ==的属性被更新，其中== ==position== ==属性从== =="Software Developer"== ==更改为== =="Senior Software Developer"====。==
 
==查询用户属性==  
==要查看用户的属性信息，可以使用== ==INFORMATION_SCHEMA.USER_ATTRIBUTES== ==表（从 MySQL 8.0.16 开始提供）：==  
==SELECT *== ==FROM== ==INFORMATION_SCHEMA.USER_ATTRIBUTES WHERE USER === =='john'== ==AND== ==HOST === =='localhost'====;==  
==注意事项==

- ==opt_user_attribute== ==支持从 MySQL 8.0 版本开始。如果你使用的 MySQL 版本较早，则可能不支持此功能。==
- ==用户属性是可选的，并且不会影响用户的认证或权限。它们主要用于记录和管理用户的相关信息。==
- ==用户属性是以 JSON 格式存储的，因此你需要确保提供的 JSON 字符串是有效的。==
- ==虽然用户属性可以存储多种类型的数据，但在实际应用中应尽量保持简单明了，以便于管理和查询。==

通过这种方式，opt_user_attribute 提供了一种灵活的方法来附加和管理用户的相关元数据，有助于增强用户管理的细节性和可维护性。
 
## 2.gbase：

不支持