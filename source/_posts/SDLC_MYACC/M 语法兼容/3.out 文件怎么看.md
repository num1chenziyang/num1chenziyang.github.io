# 一.bison 命令

bison -v -dt p_sql_mysql.Y  
使用 bison（GNU的Yacc兼容解析器生成器）来生成解析器，并且加上了-v和-dt选项时，Bison会生成一个额外的输出文件（通常是.output文件），该文件包含了状态机的信息以及关于冲突的详细报告。这个文件对于诊断和解决Shift-Reduce和Reduce-Reduce冲突非常有用。
   

# 二.out 文件怎么看

1. 打开输出文件：
    
    - 执行命令bison -v -dt p_sql_mysql.Y后，Bison将生成一个名为p_sql_mysql.output的文件。
    - 使用文本编辑器打开这个文件。
2. 查找冲突部分：
    
    - 在.output文件中，搜索关键字如“conflicts”、“shift/reduce”或“reduce/reduce”。通常，这些信息位于文件的末尾。
    - Bison会列出所有发生的冲突，并指明是哪一种类型的冲突（Shift-Reduce还是Reduce-Reduce），以及它们发生在哪个状态。
3. 分析冲突详情：
    
    - 对于每个冲突，Bison会提供相关产生式、输入符号等信息。
    - 你还可以看到导致冲突的具体LR(1)项目集，这有助于理解为什么会出现冲突。
    - 有时Bison还会给出它如何解决冲突的策略，比如根据优先级规则选择了哪一个动作。
4. 解决冲突：
    
    - 根据前面提到的方法调整你的文法：通过设置优先级、结合性、重写文法等方式来消除歧义。
    - 如果是因为文法设计上的问题，考虑是否可以重新组织文法规则以避免不必要的复杂性。
    - 如果某些冲突无法避免但对语言语义没有影响，可以通过在Yacc文件中添加%expect声明来告诉Bison预期有多少个冲突，从而抑制警告信息。
5. 重新运行Bison：
    
    - 修改完文法后，再次运行Bison命令，检查新的输出文件看是否解决了之前的冲突。
 
示例  
假设你的.output文件中有如下内容：  
==state 17====￼== ==E -> E + . T== ==$end====￼== ==E -> T . + E== ==$end====￼== ==...====￼== ==conflicts: 1== ==shift====/reduce==  
这里显示了状态17中存在一个Shift-Reduce冲突。
    
# 三.具体例子（非常重要）

## 1.找到冲突信息合集

搜索 conflicts 或者 reduce，找到冲突记录

![lt.o Il,c 11.0 n2.c _mysql.outpu _mysql.01Äu _mysql. tab. H _mysql.Y ora,Y mbol.c mbol.h 'ITIbol.o ee.h ee.o 1052 abets 1053 1054 State State State State State i State State State 196 446 451 791 848 conflicts : conflicts : conflicts : conflicts : conflicts : 1 4 1 1 1 1100 conflicts: 1364 conflicts: 1656 conflicts: ident_keywords_ambigu ident_keywords_ambigu ident_keywords_ambigu shift / reduce - / reduce reduce shift / reduce / reduce shift / reduce shift 1 shift 1 shift 2 reduce Grammar 601$aceept:l. start_entry $end I ](Exported%20image%2020250328134720-0.jpeg)     

## 2.shift/reduce 冲突

![Exported image](Exported%20image%2020250328134726-1.jpeg)

此冲突程度较轻，但是也是需要解决的。  
（1）此内容如何分析？  
<1>点（.）通常表示LR(0)项目中的当前扫描位置。具体来说，点的位置表示了当前解析器的状态和正在处理的文法规则的进度。  
<2>上半部分 P_SAVEPORINT shift，下半部分 P_SAVEPORINT [reduce]，既能移进也能规约，冲突。
   

## 3.reduce/reduce 冲突

![Exported image](Exported%20image%2020250328134728-2.jpeg)

此冲突问题严重，会影响功能。  
可以看到图中有四处 reduce/reduce 冲突。
                
移进冲突和规约冲突分别的意思并举例
 ![Exported image](Exported%20image%2020250328134730-3.png)  

在编译原理中，特别是在使用LR（Left-to-right, Rightmost derivation）解析技术时，移进冲突（Shift-Reduce Conflict）和规约冲突（Reduce-Reduce Conflict）是两种常见的语法分析冲突。这些冲突通常出现在尝试为上下文无关文法构造一个确定的解析表时。下面我将分别解释这两种冲突，并给出例子。  
移进冲突（Shift-Reduce Conflict）  
定义：当解析器面对输入符号时，既可以选择执行移进操作（shift），也可以选择执行规约操作（reduce），这时就发生了移进冲突。  
原因：

- 通常发生在文法中的某些结构可以被以多种方式解析。
- 这种不确定性导致解析器无法决定是否应该继续读取更多的输入符号（移进）还是立即根据当前栈上的符号进行归约。

例子： 考虑以下简单的算术表达式文法：
 
==bison==  
==深色版本==  
==E -> E + E====￼====E ->== ==id==  
对于输入序列 id + id，解析器在遇到第二个 id 之前可能会遇到移进冲突。具体来说，在处理完第一个 id 并将其规约为 E 后，栈上可能是 E，而下一个输入符号是 +。此时解析器面临两个选择：

1. 移进 + 到栈上，因为接下来可能还有更多的运算符或操作数。
2. 规约当前的 E，因为它已经是一个完整的表达式了。

为了解决这种冲突，通常会通过定义运算符优先级来明确解析顺序，比如规定加法运算符具有较低的优先级，从而指导解析器先移进而不是规约。  
规约冲突（Reduce-Reduce Conflict）  
定义：当解析器在同一时刻有多个不同的规约动作可选时发生。  
原因：

- 通常表明文法存在冗余或不一致的地方，导致同一个符号串可以被不同产生式规约为不同的非终结符。
- 这意味着解析器不确定应该使用哪个规则来进行规约。

例子： 假设有一个文法如下：
 
==bison==  
==深色版本==  
==S -> A B====￼====A -> a====￼====B -> b====￼====A -> b==  
对于输入 b，解析器可以有两种选择：

1. 使用 A -> b 将 b 规约为 A。
2. 使用 B -> b 将 b 规约为 B。

由于这两个规则都匹配输入 b，因此产生了规约冲突。  
要解决这种冲突，通常需要检查文法并删除冗余的规则，或者重新组织文法规则以消除歧义。例如，在上述例子中，可以通过合并规则或将 A 和 B 的定义区分开来解决冲突。  
总结

- 移进冲突 是关于何时执行移进操作和何时执行规约操作的选择问题，通常通过定义运算符优先级和结合性来解决。
- 规约冲突 是关于选择哪一个产生式进行规约的问题，通常通过简化或重写文法来解决。

理解这些冲突的本质以及如何解决它们对于编写有效的解析器是非常重要的。
   

![788 identificatiöte $default reduce using rule 788 (identification) State 782 auth 789 446 create user: user identified with_ptugin • opt_initial identification: identified with _ plugin • P ACCOUNT ACCOUNT p-AND END OF INPUT p-ENfOÜINPUT COMMA- COMMA SEMI SEMI $default opt_initial reduce using rule 787 (opt _ initiat auth) [ reduce using rule 789 (identification)] reduce using rule 789 (identification) reduce using rule 787 (opt _ initial auth) [ reduce using rule 789 (identification) I reduce using rule 787 (opt. initial auth) reduce using rule 789 (identificaEion)] reduce using rule' 787 (opt_initial auth) [reduce; using rule 789 (identificaEion)] reduce using ruleb 71 o to state 590 ](Exported%20image%2020250328134732-4.jpeg)