# 一.sql_yacc.yy 介绍

sql_yacc.yy 文件是 MySQL 数据库源代码中的一个非常重要的文件。这个文件是一个 YACC (Yet Another Compiler Compiler) 文件，用于定义 MySQL SQL 语句的语法结构。
 
YACC 是一种编译器生成工具，它可以帮助开发者从一组文法规则中生成解析器。在 MySQL 中，sql_yacc.yy 定义了 SQL 语言的文法，这些规则告诉 MySQL 如何解析用户输入的 SQL 语句。
 
==sql_yacc.yy 文件包含了一系列的 BNF（Backus-Naur Form）风格的文法规则。每条规则定义了一种特定的 SQL 语句或者表达式的结构。==
    
# 二.sql_yacc.yy 分析

## 1.简述

YACC 文件中的文法规则定义了如何将输入的词素（tokens）组合成有效的 SQL 语句。每个规则由以下几个部分组成：

1. ==非终结符：表示可以进一步分解的符号，通常是 SQL 语句的一部分。==
2. ==终结符：表示具体的词素（tokens），如关键字、标识符、常量等。==
3. ==动作：在解析过程中执行的 C 语言代码片段，用于处理解析结果。==
   

## 2.文法规则的基本结构

==<1>====一个典型的 YACC 规则结构如下：==  
==nonterminal : terminal1 terminal2 ... terminalN====￼===={====￼== ==// 动作：处理解析结果的 C 语言代码====￼====}====￼====;==  
==详细解释==

1. ==非终结符：这是规则的左侧，表示一个可以进一步分解的符号。例如，select_statement 表示一个完整的 SELECT 语句。==
2. ==终结符：这是规则的右侧，表示具体的词素。例如，SELECT、FROM、WHERE 等都是终结符。==
3. ==动作：这是在解析过程中执行的 C 语言代码片段，用于处理解析结果。动作中的变量 $1, $2, ..., $n 分别表示右侧的第1个、第2个、...、第n个符号的值。==
   

## 3.示例：SELECT 语句

==我们要定义一个简单的 SELECT 语句的文法规则。我们可以通过以下步骤来详细解释：==

1. ==定义非终结符：select_statement 表示一个完整的 SELECT 语句。==
2. ==定义终结符：SELECT, FROM, WHERE 等是 SQL 关键字，IDENTIFIER 表示表名或列名，INTEGER 表示整数。==
3. ==定义动作：在解析过程中执行的 C 语言代码片段，用于处理解析结果。==
 
==<1>====基本的 SELECT 语句==  
==select_statement:====￼== ==SELECT select_list FROM table_name====￼== =={====￼== ==// 动作：处理 SELECT 语句的逻辑====￼== ==printf====(===="Parsed SELECT statement: SELECT %s FROM %s\n"====,== ==$2====,== ==$4====);====￼== ==}====￼====;==

- ==select_statement：非终结符，表示一个完整的 SELECT 语句。==
- ==SELECT：终结符，表示 SQL 关键字 SELECT。==
- ==select_list：非终结符，表示要选择的列列表。==
- ==FROM：终结符，表示 SQL 关键字 FROM。==
- ==table_name：非终结符，表示表名。==
 
==<2>====定义 select_list==  
==select_list:====￼== ==column_name====￼== =={====￼== ==// 动作：处理单个列名====￼== ==$$ = strdup($====1====);== ==// 将列名复制到结果中====￼== ==}====￼====| select_list== ==','== ==column_name====￼== =={====￼== ==// 动作：处理多个列名====￼== ==char== ==*result = (====char== ==*)====malloc====(====strlen====($====1====) +== ==strlen====($====3====) +== ==2====);====￼== ==sprintf====(result,== =="%s,%s"====, $====1====, $====3====);====￼== ==free====($====1====);====￼== ==free====($====3====);====￼== ==$$ = result;====￼== ==}====￼====;==

- ==select_list：非终结符，表示要选择的列列表。==
- ==column_name：非终结符，表示列名。==
- ==','：终结符，表示逗号。==
 
==<3>====定义 table_name==  
==table_name:====￼== ==IDENTIFIER====￼== =={====￼== ==// 动作：处理表名====￼== ==$$ = strdup($====1====);== ==// 将表名复制到结果中====￼== ==}====￼====;==

- ==table_name：非终结符，表示表名。==
- ==IDENTIFIER：终结符，表示标识符（表名或列名）。==
   

## 4.完整的 YACC 文件示例

==%{====￼====#include <stdio.h>====￼====#include <stdlib.h>====￼====#include <string.h>==  
==// 假设词法分析器返回的 token 类型====￼====#define SELECT 258====￼====#define FROM 259====￼====#define IDENTIFIER 260====￼====%}==  
==%====union== =={====￼== ==char== ==*str;====￼====}==  
==%token <str> IDENTIFIER====￼====%token SELECT FROM==  
==%type <str> select_list table_name==  
**%%**  
==select_statement:====￼== ==SELECT select_list FROM table_name====￼== =={====￼== ==printf====(===="Parsed SELECT statement: SELECT %s FROM %s\n"====, $====2====, $====4====);====￼== ==}====￼====;==  
==select_list:====￼== ==column_name====￼== =={====￼== ==$$ = strdup($====1====);====￼== ==}====￼====| select_list== ==','== ==column_name====￼== =={====￼== ==char== ==*result = (====char== ==*)====malloc====(====strlen====($====1====) +== ==strlen====($====3====) +== ==2====);====￼== ==sprintf====(result,== =="%s,%s"====, $====1====, $====3====);====￼== ==free====($====1====);====￼== ==free====($====3====);====￼== ==$$ = result;====￼== ==}====￼====;==  
==column_name:====￼== ==IDENTIFIER====￼== =={====￼== ==$$ = strdup($====1====);====￼== ==}====￼====;==  
==table_name:====￼== ==IDENTIFIER====￼== =={====￼== ==$$ = strdup($====1====);====￼== ==}====￼====;==
 
==/* 先不用在乎 main 这部分 */==  
==%%==  
==int== ==main====()== =={====￼== ==yyparse();====￼== ==return== ==0====;====￼====}==  
==void== ==yyerror====(====const char== ==*s)== =={====￼== ==fprintf====(====stderr====,== =="Error: %s\n"====, s);====￼====}==  
==详细解释==

1. ==词法分析器：假设词法分析器返回的 token 类型为 SELECT, FROM, IDENTIFIER。==
2. ==%union：定义了一个联合体，用于存储不同类型的数据。==
3. ==%token：定义了终结符及其类型。==
4. ==%type：定义了非终结符及其类型。==
5. ==规则：==
    
    - ==select_statement：定义了一个完整的 SELECT 语句。==
    - ==select_list：定义了列列表。==
    - ==column_name：定义了列名。==
    - ==table_name：定义了表名。==
6. ==动作：在解析过程中执行的 C 语言代码片段，用于处理解析结果。==
7. ==main 函数：调用 yyparse 开始解析。==
8. ==yyerror 函数：处理解析错误。==